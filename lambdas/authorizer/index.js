var Il=Object.create;var Ur=Object.defineProperty;var Ol=Object.getOwnPropertyDescriptor;var Dl=Object.getOwnPropertyNames;var ql=Object.getPrototypeOf,Fl=Object.prototype.hasOwnProperty;var Fi=n=>{throw TypeError(n)};var Kt=(n,r)=>()=>(n&&(r=n(n=0)),r);var ro=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),xi=(n,r)=>{for(var i in r)Ur(n,i,{get:r[i],enumerable:!0})},Li=(n,r,i,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Dl(r))!Fl.call(n,a)&&a!==i&&Ur(n,a,{get:()=>r[a],enumerable:!(s=Ol(r,a))||s.enumerable});return n};var He=(n,r,i)=>(i=n!=null?Il(ql(n)):{},Li(r||!n||!n.__esModule?Ur(i,"default",{value:n,enumerable:!0}):i,n)),xl=n=>Li(Ur({},"__esModule",{value:!0}),n);var zi=(n,r,i)=>r.has(n)||Fi("Cannot "+i);var z=(n,r,i)=>(zi(n,r,"read from private field"),i?i.call(n):r.get(n)),de=(n,r,i)=>r.has(n)?Fi("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,i),Z=(n,r,i,s)=>(zi(n,r,"write to private field"),s?s.call(n,i):r.set(n,i),i);var os=ro((nn,ns)=>{(function(n,r){typeof nn=="object"&&typeof ns<"u"?r(nn):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n.WebStreamsPolyfill={}))})(nn,function(n){"use strict";function r(){}function i(e){return typeof e=="object"&&e!==null||typeof e=="function"}let s=r;function a(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}let f=Promise,h=Promise.prototype.then,w=Promise.reject.bind(f);function p(e){return new f(e)}function m(e){return p(t=>t(e))}function b(e){return w(e)}function W(e,t,o){return h.call(e,t,o)}function T(e,t,o){W(W(e,t,o),void 0,s)}function O(e,t){T(e,t)}function g(e,t){T(e,void 0,t)}function F(e,t,o){return W(e,t,o)}function v(e){W(e,void 0,s)}let A=e=>{if(typeof queueMicrotask=="function")A=queueMicrotask;else{let t=m(void 0);A=o=>W(t,o)}return A(e)};function x(e,t,o){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,o)}function U(e,t,o){try{return m(x(e,t,o))}catch(l){return b(l)}}let k=16384;class B{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){let o=this._back,l=o;o._elements.length===k-1&&(l={_elements:[],_next:void 0}),o._elements.push(t),l!==o&&(this._back=l,o._next=l),++this._size}shift(){let t=this._front,o=t,l=this._cursor,u=l+1,c=t._elements,d=c[l];return u===k&&(o=t._next,u=0),--this._size,this._cursor=u,t!==o&&(this._front=o),c[l]=void 0,d}forEach(t){let o=this._cursor,l=this._front,u=l._elements;for(;(o!==u.length||l._next!==void 0)&&!(o===u.length&&(l=l._next,u=l._elements,o=0,u.length===0));)t(u[o]),++o}peek(){let t=this._front,o=this._cursor;return t._elements[o]}}let L=Symbol("[[AbortSteps]]"),qe=Symbol("[[ErrorSteps]]"),Ft=Symbol("[[CancelSteps]]"),bn=Symbol("[[PullSteps]]"),yn=Symbol("[[ReleaseSteps]]");function So(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?wn(e):t._state==="closed"?Us(e):_o(e,t._storedError)}function gn(e,t){let o=e._ownerReadableStream;return fe(o,t)}function we(e){let t=e._ownerReadableStream;t._state==="readable"?Sn(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Ms(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[yn](),t._reader=void 0,e._ownerReadableStream=void 0}function dr(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function wn(e){e._closedPromise=p((t,o)=>{e._closedPromise_resolve=t,e._closedPromise_reject=o})}function _o(e,t){wn(e),Sn(e,t)}function Us(e){wn(e),Ro(e)}function Sn(e,t){e._closedPromise_reject!==void 0&&(v(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function Ms(e,t){_o(e,t)}function Ro(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let To=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},Js=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function Ns(e){return typeof e=="object"||typeof e=="function"}function me(e,t){if(e!==void 0&&!Ns(e))throw new TypeError(`${t} is not an object.`)}function ne(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function Hs(e){return typeof e=="object"&&e!==null||typeof e=="function"}function Co(e,t){if(!Hs(e))throw new TypeError(`${t} is not an object.`)}function Se(e,t,o){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${o}'.`)}function _n(e,t,o){if(e===void 0)throw new TypeError(`${t} is required in '${o}'.`)}function Rn(e){return Number(e)}function Po(e){return e===0?0:e}function Ks(e){return Po(Js(e))}function Tn(e,t){let l=Number.MAX_SAFE_INTEGER,u=Number(e);if(u=Po(u),!To(u))throw new TypeError(`${t} is not a finite number`);if(u=Ks(u),u<0||u>l)throw new TypeError(`${t} is outside the accepted range of 0 to ${l}, inclusive`);return!To(u)||u===0?0:u}function Cn(e,t){if(!Ue(e))throw new TypeError(`${t} is not a ReadableStream.`)}function mt(e){return new Fe(e)}function Eo(e,t){e._reader._readRequests.push(t)}function Pn(e,t,o){let u=e._reader._readRequests.shift();o?u._closeSteps():u._chunkSteps(t)}function hr(e){return e._reader._readRequests.length}function Ao(e){let t=e._reader;return!(t===void 0||!xe(t))}class Fe{constructor(t){if(Se(t,1,"ReadableStreamDefaultReader"),Cn(t,"First parameter"),Me(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");So(this,t),this._readRequests=new B}get closed(){return xe(this)?this._closedPromise:b(mr("closed"))}cancel(t=void 0){return xe(this)?this._ownerReadableStream===void 0?b(dr("cancel")):gn(this,t):b(mr("cancel"))}read(){if(!xe(this))return b(mr("read"));if(this._ownerReadableStream===void 0)return b(dr("read from"));let t,o,l=p((c,d)=>{t=c,o=d});return xt(this,{_chunkSteps:c=>t({value:c,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:c=>o(c)}),l}releaseLock(){if(!xe(this))throw mr("releaseLock");this._ownerReadableStream!==void 0&&Vs(this)}}Object.defineProperties(Fe.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a(Fe.prototype.cancel,"cancel"),a(Fe.prototype.read,"read"),a(Fe.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Fe.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function xe(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Fe}function xt(e,t){let o=e._ownerReadableStream;o._disturbed=!0,o._state==="closed"?t._closeSteps():o._state==="errored"?t._errorSteps(o._storedError):o._readableStreamController[bn](t)}function Vs(e){we(e);let t=new TypeError("Reader was released");vo(e,t)}function vo(e,t){let o=e._readRequests;e._readRequests=new B,o.forEach(l=>{l._errorSteps(t)})}function mr(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let Ys=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class ko{constructor(t,o){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=o}next(){let t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?F(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){let o=()=>this._returnSteps(t);return this._ongoingPromise?F(this._ongoingPromise,o,o):o()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let t=this._reader,o,l,u=p((d,y)=>{o=d,l=y});return xt(t,{_chunkSteps:d=>{this._ongoingPromise=void 0,A(()=>o({value:d,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,we(t),o({value:void 0,done:!0})},_errorSteps:d=>{this._ongoingPromise=void 0,this._isFinished=!0,we(t),l(d)}}),u}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;let o=this._reader;if(!this._preventCancel){let l=gn(o,t);return we(o),F(l,()=>({value:t,done:!0}))}return we(o),m({value:t,done:!0})}}let Bo={next(){return Wo(this)?this._asyncIteratorImpl.next():b(Io("next"))},return(e){return Wo(this)?this._asyncIteratorImpl.return(e):b(Io("return"))}};Object.setPrototypeOf(Bo,Ys);function Qs(e,t){let o=mt(e),l=new ko(o,t),u=Object.create(Bo);return u._asyncIteratorImpl=l,u}function Wo(e){if(!i(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof ko}catch{return!1}}function Io(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let Oo=Number.isNaN||function(e){return e!==e};var En,An,vn;function Lt(e){return e.slice()}function Do(e,t,o,l,u){new Uint8Array(e).set(new Uint8Array(o,l,u),t)}let _e=e=>(typeof e.transfer=="function"?_e=t=>t.transfer():typeof structuredClone=="function"?_e=t=>structuredClone(t,{transfer:[t]}):_e=t=>t,_e(e)),Le=e=>(typeof e.detached=="boolean"?Le=t=>t.detached:Le=t=>t.byteLength===0,Le(e));function qo(e,t,o){if(e.slice)return e.slice(t,o);let l=o-t,u=new ArrayBuffer(l);return Do(u,0,e,t,l),u}function pr(e,t){let o=e[t];if(o!=null){if(typeof o!="function")throw new TypeError(`${String(t)} is not a function`);return o}}function Gs(e){let t={[Symbol.iterator]:()=>e.iterator},o=async function*(){return yield*t}(),l=o.next;return{iterator:o,nextMethod:l,done:!1}}let kn=(vn=(En=Symbol.asyncIterator)!==null&&En!==void 0?En:(An=Symbol.for)===null||An===void 0?void 0:An.call(Symbol,"Symbol.asyncIterator"))!==null&&vn!==void 0?vn:"@@asyncIterator";function Fo(e,t="sync",o){if(o===void 0)if(t==="async"){if(o=pr(e,kn),o===void 0){let c=pr(e,Symbol.iterator),d=Fo(e,"sync",c);return Gs(d)}}else o=pr(e,Symbol.iterator);if(o===void 0)throw new TypeError("The object is not iterable");let l=x(o,e,[]);if(!i(l))throw new TypeError("The iterator method must return an object");let u=l.next;return{iterator:l,nextMethod:u,done:!1}}function Zs(e){let t=x(e.nextMethod,e.iterator,[]);if(!i(t))throw new TypeError("The iterator.next() method must return an object");return t}function Xs(e){return!!e.done}function ea(e){return e.value}function ta(e){return!(typeof e!="number"||Oo(e)||e<0)}function xo(e){let t=qo(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Bn(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Wn(e,t,o){if(!ta(o)||o===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:o}),e._queueTotalSize+=o}function ra(e){return e._queue.peek().value}function ze(e){e._queue=new B,e._queueTotalSize=0}function Lo(e){return e===DataView}function na(e){return Lo(e.constructor)}function oa(e){return Lo(e)?1:e.BYTES_PER_ELEMENT}class Ye{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!In(this))throw xn("view");return this._view}respond(t){if(!In(this))throw xn("respond");if(Se(t,1,"respond"),t=Tn(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Le(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");wr(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!In(this))throw xn("respondWithNewView");if(Se(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Le(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Sr(this._associatedReadableByteStreamController,t)}}Object.defineProperties(Ye.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),a(Ye.prototype.respond,"respond"),a(Ye.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Re{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Qe(this))throw $t("byobRequest");return Fn(this)}get desiredSize(){if(!Qe(this))throw $t("desiredSize");return Vo(this)}close(){if(!Qe(this))throw $t("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);zt(this)}enqueue(t){if(!Qe(this))throw $t("enqueue");if(Se(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be enqueued to`);gr(this,t)}error(t=void 0){if(!Qe(this))throw $t("error");oe(this,t)}[Ft](t){zo(this),ze(this);let o=this._cancelAlgorithm(t);return yr(this),o}[bn](t){let o=this._controlledReadableByteStream;if(this._queueTotalSize>0){Ko(this,t);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let u;try{u=new ArrayBuffer(l)}catch(d){t._errorSteps(d);return}let c={buffer:u,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(c)}Eo(o,t),Ge(this)}[yn](){if(this._pendingPullIntos.length>0){let t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new B,this._pendingPullIntos.push(t)}}}Object.defineProperties(Re.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),a(Re.prototype.close,"close"),a(Re.prototype.enqueue,"enqueue"),a(Re.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Re.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Qe(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof Re}function In(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof Ye}function Ge(e){if(!ua(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();T(o,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Ge(e)),null),l=>(oe(e,l),null))}function zo(e){Dn(e),e._pendingPullIntos=new B}function On(e,t){let o=!1;e._state==="closed"&&(o=!0);let l=$o(t);t.readerType==="default"?Pn(e,l,o):pa(e,l,o)}function $o(e){let t=e.bytesFilled,o=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/o)}function br(e,t,o,l){e._queue.push({buffer:t,byteOffset:o,byteLength:l}),e._queueTotalSize+=l}function jo(e,t,o,l){let u;try{u=qo(t,o,o+l)}catch(c){throw oe(e,c),c}br(e,u,0,l)}function Uo(e,t){t.bytesFilled>0&&jo(e,t.buffer,t.byteOffset,t.bytesFilled),pt(e)}function Mo(e,t){let o=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),l=t.bytesFilled+o,u=o,c=!1,d=l%t.elementSize,y=l-d;y>=t.minimumFill&&(u=y-t.bytesFilled,c=!0);let R=e._queue;for(;u>0;){let S=R.peek(),C=Math.min(u,S.byteLength),P=t.byteOffset+t.bytesFilled;Do(t.buffer,P,S.buffer,S.byteOffset,C),S.byteLength===C?R.shift():(S.byteOffset+=C,S.byteLength-=C),e._queueTotalSize-=C,Jo(e,C,t),u-=C}return c}function Jo(e,t,o){o.bytesFilled+=t}function No(e){e._queueTotalSize===0&&e._closeRequested?(yr(e),Ht(e._controlledReadableByteStream)):Ge(e)}function Dn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function qn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let t=e._pendingPullIntos.peek();Mo(e,t)&&(pt(e),On(e._controlledReadableByteStream,t))}}function ia(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(e._queueTotalSize===0)return;let o=t._readRequests.shift();Ko(e,o)}}function sa(e,t,o,l){let u=e._controlledReadableByteStream,c=t.constructor,d=oa(c),{byteOffset:y,byteLength:R}=t,S=o*d,C;try{C=_e(t.buffer)}catch(I){l._errorSteps(I);return}let P={buffer:C,bufferByteLength:C.byteLength,byteOffset:y,byteLength:R,bytesFilled:0,minimumFill:S,elementSize:d,viewConstructor:c,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(P),Go(u,l);return}if(u._state==="closed"){let I=new c(P.buffer,P.byteOffset,0);l._closeSteps(I);return}if(e._queueTotalSize>0){if(Mo(e,P)){let I=$o(P);No(e),l._chunkSteps(I);return}if(e._closeRequested){let I=new TypeError("Insufficient bytes to fill elements in the given buffer");oe(e,I),l._errorSteps(I);return}}e._pendingPullIntos.push(P),Go(u,l),Ge(e)}function aa(e,t){t.readerType==="none"&&pt(e);let o=e._controlledReadableByteStream;if(Ln(o))for(;Zo(o)>0;){let l=pt(e);On(o,l)}}function la(e,t,o){if(Jo(e,t,o),o.readerType==="none"){Uo(e,o),qn(e);return}if(o.bytesFilled<o.minimumFill)return;pt(e);let l=o.bytesFilled%o.elementSize;if(l>0){let u=o.byteOffset+o.bytesFilled;jo(e,o.buffer,u-l,l)}o.bytesFilled-=l,On(e._controlledReadableByteStream,o),qn(e)}function Ho(e,t){let o=e._pendingPullIntos.peek();Dn(e),e._controlledReadableByteStream._state==="closed"?aa(e,o):la(e,t,o),Ge(e)}function pt(e){return e._pendingPullIntos.shift()}function ua(e){let t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(Ao(t)&&hr(t)>0||Ln(t)&&Zo(t)>0||Vo(e)>0)}function yr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function zt(e){let t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let o=e._pendingPullIntos.peek();if(o.bytesFilled%o.elementSize!==0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw oe(e,l),l}}yr(e),Ht(t)}}function gr(e,t){let o=e._controlledReadableByteStream;if(e._closeRequested||o._state!=="readable")return;let{buffer:l,byteOffset:u,byteLength:c}=t;if(Le(l))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let d=_e(l);if(e._pendingPullIntos.length>0){let y=e._pendingPullIntos.peek();if(Le(y.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Dn(e),y.buffer=_e(y.buffer),y.readerType==="none"&&Uo(e,y)}if(Ao(o))if(ia(e),hr(o)===0)br(e,d,u,c);else{e._pendingPullIntos.length>0&&pt(e);let y=new Uint8Array(d,u,c);Pn(o,y,!1)}else Ln(o)?(br(e,d,u,c),qn(e)):br(e,d,u,c);Ge(e)}function oe(e,t){let o=e._controlledReadableByteStream;o._state==="readable"&&(zo(e),ze(e),yr(e),Ri(o,t))}function Ko(e,t){let o=e._queue.shift();e._queueTotalSize-=o.byteLength,No(e);let l=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);t._chunkSteps(l)}function Fn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),o=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),l=Object.create(Ye.prototype);ca(l,e,o),e._byobRequest=l}return e._byobRequest}function Vo(e){let t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function wr(e,t){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(o.bytesFilled+t>o.byteLength)throw new RangeError("bytesWritten out of range")}o.buffer=_e(o.buffer),Ho(e,t)}function Sr(e,t){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(o.byteOffset+o.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(o.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(o.bytesFilled+t.byteLength>o.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let u=t.byteLength;o.buffer=_e(t.buffer),Ho(e,u)}function Yo(e,t,o,l,u,c,d){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,ze(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=c,t._pullAlgorithm=l,t._cancelAlgorithm=u,t._autoAllocateChunkSize=d,t._pendingPullIntos=new B,e._readableStreamController=t;let y=o();T(m(y),()=>(t._started=!0,Ge(t),null),R=>(oe(t,R),null))}function fa(e,t,o){let l=Object.create(Re.prototype),u,c,d;t.start!==void 0?u=()=>t.start(l):u=()=>{},t.pull!==void 0?c=()=>t.pull(l):c=()=>m(void 0),t.cancel!==void 0?d=R=>t.cancel(R):d=()=>m(void 0);let y=t.autoAllocateChunkSize;if(y===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Yo(e,l,u,c,d,o,y)}function ca(e,t,o){e._associatedReadableByteStreamController=t,e._view=o}function xn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function $t(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function da(e,t){me(e,t);let o=e?.mode;return{mode:o===void 0?void 0:ha(o,`${t} has member 'mode' that`)}}function ha(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function ma(e,t){var o;me(e,t);let l=(o=e?.min)!==null&&o!==void 0?o:1;return{min:Tn(l,`${t} has member 'min' that`)}}function Qo(e){return new $e(e)}function Go(e,t){e._reader._readIntoRequests.push(t)}function pa(e,t,o){let u=e._reader._readIntoRequests.shift();o?u._closeSteps(t):u._chunkSteps(t)}function Zo(e){return e._reader._readIntoRequests.length}function Ln(e){let t=e._reader;return!(t===void 0||!Ze(t))}class $e{constructor(t){if(Se(t,1,"ReadableStreamBYOBReader"),Cn(t,"First parameter"),Me(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Qe(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");So(this,t),this._readIntoRequests=new B}get closed(){return Ze(this)?this._closedPromise:b(_r("closed"))}cancel(t=void 0){return Ze(this)?this._ownerReadableStream===void 0?b(dr("cancel")):gn(this,t):b(_r("cancel"))}read(t,o={}){if(!Ze(this))return b(_r("read"));if(!ArrayBuffer.isView(t))return b(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return b(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return b(new TypeError("view's buffer must have non-zero byteLength"));if(Le(t.buffer))return b(new TypeError("view's buffer has been detached"));let l;try{l=ma(o,"options")}catch(S){return b(S)}let u=l.min;if(u===0)return b(new TypeError("options.min must be greater than 0"));if(na(t)){if(u>t.byteLength)return b(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(u>t.length)return b(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return b(dr("read from"));let c,d,y=p((S,C)=>{c=S,d=C});return Xo(this,t,u,{_chunkSteps:S=>c({value:S,done:!1}),_closeSteps:S=>c({value:S,done:!0}),_errorSteps:S=>d(S)}),y}releaseLock(){if(!Ze(this))throw _r("releaseLock");this._ownerReadableStream!==void 0&&ba(this)}}Object.defineProperties($e.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a($e.prototype.cancel,"cancel"),a($e.prototype.read,"read"),a($e.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($e.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Ze(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof $e}function Xo(e,t,o,l){let u=e._ownerReadableStream;u._disturbed=!0,u._state==="errored"?l._errorSteps(u._storedError):sa(u._readableStreamController,t,o,l)}function ba(e){we(e);let t=new TypeError("Reader was released");ei(e,t)}function ei(e,t){let o=e._readIntoRequests;e._readIntoRequests=new B,o.forEach(l=>{l._errorSteps(t)})}function _r(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function jt(e,t){let{highWaterMark:o}=e;if(o===void 0)return t;if(Oo(o)||o<0)throw new RangeError("Invalid highWaterMark");return o}function Rr(e){let{size:t}=e;return t||(()=>1)}function Tr(e,t){me(e,t);let o=e?.highWaterMark,l=e?.size;return{highWaterMark:o===void 0?void 0:Rn(o),size:l===void 0?void 0:ya(l,`${t} has member 'size' that`)}}function ya(e,t){return ne(e,t),o=>Rn(e(o))}function ga(e,t){me(e,t);let o=e?.abort,l=e?.close,u=e?.start,c=e?.type,d=e?.write;return{abort:o===void 0?void 0:wa(o,e,`${t} has member 'abort' that`),close:l===void 0?void 0:Sa(l,e,`${t} has member 'close' that`),start:u===void 0?void 0:_a(u,e,`${t} has member 'start' that`),write:d===void 0?void 0:Ra(d,e,`${t} has member 'write' that`),type:c}}function wa(e,t,o){return ne(e,o),l=>U(e,t,[l])}function Sa(e,t,o){return ne(e,o),()=>U(e,t,[])}function _a(e,t,o){return ne(e,o),l=>x(e,t,[l])}function Ra(e,t,o){return ne(e,o),(l,u)=>U(e,t,[l,u])}function ti(e,t){if(!bt(e))throw new TypeError(`${t} is not a WritableStream.`)}function Ta(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let Ca=typeof AbortController=="function";function Pa(){if(Ca)return new AbortController}class je{constructor(t={},o={}){t===void 0?t=null:Co(t,"First parameter");let l=Tr(o,"Second parameter"),u=ga(t,"First parameter");if(ni(this),u.type!==void 0)throw new RangeError("Invalid type is specified");let d=Rr(l),y=jt(l,1);za(this,u,y,d)}get locked(){if(!bt(this))throw vr("locked");return yt(this)}abort(t=void 0){return bt(this)?yt(this)?b(new TypeError("Cannot abort a stream that already has a writer")):Cr(this,t):b(vr("abort"))}close(){return bt(this)?yt(this)?b(new TypeError("Cannot close a stream that already has a writer")):pe(this)?b(new TypeError("Cannot close an already-closing stream")):oi(this):b(vr("close"))}getWriter(){if(!bt(this))throw vr("getWriter");return ri(this)}}Object.defineProperties(je.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),a(je.prototype.abort,"abort"),a(je.prototype.close,"close"),a(je.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(je.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function ri(e){return new Te(e)}function Ea(e,t,o,l,u=1,c=()=>1){let d=Object.create(je.prototype);ni(d);let y=Object.create(gt.prototype);return fi(d,y,e,t,o,l,u,c),d}function ni(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new B,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function bt(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof je}function yt(e){return e._writer!==void 0}function Cr(e,t){var o;if(e._state==="closed"||e._state==="errored")return m(void 0);e._writableStreamController._abortReason=t,(o=e._writableStreamController._abortController)===null||o===void 0||o.abort(t);let l=e._state;if(l==="closed"||l==="errored")return m(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let u=!1;l==="erroring"&&(u=!0,t=void 0);let c=p((d,y)=>{e._pendingAbortRequest={_promise:void 0,_resolve:d,_reject:y,_reason:t,_wasAlreadyErroring:u}});return e._pendingAbortRequest._promise=c,u||$n(e,t),c}function oi(e){let t=e._state;if(t==="closed"||t==="errored")return b(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));let o=p((u,c)=>{let d={_resolve:u,_reject:c};e._closeRequest=d}),l=e._writer;return l!==void 0&&e._backpressure&&t==="writable"&&Vn(l),$a(e._writableStreamController),o}function Aa(e){return p((o,l)=>{let u={_resolve:o,_reject:l};e._writeRequests.push(u)})}function zn(e,t){if(e._state==="writable"){$n(e,t);return}jn(e)}function $n(e,t){let o=e._writableStreamController;e._state="erroring",e._storedError=t;let l=e._writer;l!==void 0&&si(l,t),!Ia(e)&&o._started&&jn(e)}function jn(e){e._state="errored",e._writableStreamController[qe]();let t=e._storedError;if(e._writeRequests.forEach(u=>{u._reject(t)}),e._writeRequests=new B,e._pendingAbortRequest===void 0){Pr(e);return}let o=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,o._wasAlreadyErroring){o._reject(t),Pr(e);return}let l=e._writableStreamController[L](o._reason);T(l,()=>(o._resolve(),Pr(e),null),u=>(o._reject(u),Pr(e),null))}function va(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function ka(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,zn(e,t)}function Ba(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let o=e._writer;o!==void 0&&mi(o)}function Wa(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),zn(e,t)}function pe(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Ia(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Oa(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Da(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Pr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;t!==void 0&&Hn(t,e._storedError)}function Un(e,t){let o=e._writer;o!==void 0&&t!==e._backpressure&&(t?Ka(o):Vn(o)),e._backpressure=t}class Te{constructor(t){if(Se(t,1,"WritableStreamDefaultWriter"),ti(t,"First parameter"),yt(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;let o=t._state;if(o==="writable")!pe(t)&&t._backpressure?Br(this):pi(this),kr(this);else if(o==="erroring")Kn(this,t._storedError),kr(this);else if(o==="closed")pi(this),Na(this);else{let l=t._storedError;Kn(this,l),hi(this,l)}}get closed(){return Xe(this)?this._closedPromise:b(et("closed"))}get desiredSize(){if(!Xe(this))throw et("desiredSize");if(this._ownerWritableStream===void 0)throw Mt("desiredSize");return La(this)}get ready(){return Xe(this)?this._readyPromise:b(et("ready"))}abort(t=void 0){return Xe(this)?this._ownerWritableStream===void 0?b(Mt("abort")):qa(this,t):b(et("abort"))}close(){if(!Xe(this))return b(et("close"));let t=this._ownerWritableStream;return t===void 0?b(Mt("close")):pe(t)?b(new TypeError("Cannot close an already-closing stream")):ii(this)}releaseLock(){if(!Xe(this))throw et("releaseLock");this._ownerWritableStream!==void 0&&ai(this)}write(t=void 0){return Xe(this)?this._ownerWritableStream===void 0?b(Mt("write to")):li(this,t):b(et("write"))}}Object.defineProperties(Te.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),a(Te.prototype.abort,"abort"),a(Te.prototype.close,"close"),a(Te.prototype.releaseLock,"releaseLock"),a(Te.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Te.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Xe(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof Te}function qa(e,t){let o=e._ownerWritableStream;return Cr(o,t)}function ii(e){let t=e._ownerWritableStream;return oi(t)}function Fa(e){let t=e._ownerWritableStream,o=t._state;return pe(t)||o==="closed"?m(void 0):o==="errored"?b(t._storedError):ii(e)}function xa(e,t){e._closedPromiseState==="pending"?Hn(e,t):Ha(e,t)}function si(e,t){e._readyPromiseState==="pending"?bi(e,t):Va(e,t)}function La(e){let t=e._ownerWritableStream,o=t._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:ci(t._writableStreamController)}function ai(e){let t=e._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");si(e,o),xa(e,o),t._writer=void 0,e._ownerWritableStream=void 0}function li(e,t){let o=e._ownerWritableStream,l=o._writableStreamController,u=ja(l,t);if(o!==e._ownerWritableStream)return b(Mt("write to"));let c=o._state;if(c==="errored")return b(o._storedError);if(pe(o)||c==="closed")return b(new TypeError("The stream is closing or closed and cannot be written to"));if(c==="erroring")return b(o._storedError);let d=Aa(o);return Ua(l,t,u),d}let ui={};class gt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Mn(this))throw Nn("abortReason");return this._abortReason}get signal(){if(!Mn(this))throw Nn("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!Mn(this))throw Nn("error");this._controlledWritableStream._state==="writable"&&di(this,t)}[L](t){let o=this._abortAlgorithm(t);return Er(this),o}[qe](){ze(this)}}Object.defineProperties(gt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Mn(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof gt}function fi(e,t,o,l,u,c,d,y){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,ze(t),t._abortReason=void 0,t._abortController=Pa(),t._started=!1,t._strategySizeAlgorithm=y,t._strategyHWM=d,t._writeAlgorithm=l,t._closeAlgorithm=u,t._abortAlgorithm=c;let R=Jn(t);Un(e,R);let S=o(),C=m(S);T(C,()=>(t._started=!0,Ar(t),null),P=>(t._started=!0,zn(e,P),null))}function za(e,t,o,l){let u=Object.create(gt.prototype),c,d,y,R;t.start!==void 0?c=()=>t.start(u):c=()=>{},t.write!==void 0?d=S=>t.write(S,u):d=()=>m(void 0),t.close!==void 0?y=()=>t.close():y=()=>m(void 0),t.abort!==void 0?R=S=>t.abort(S):R=()=>m(void 0),fi(e,u,c,d,y,R,o,l)}function Er(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function $a(e){Wn(e,ui,0),Ar(e)}function ja(e,t){try{return e._strategySizeAlgorithm(t)}catch(o){return Ut(e,o),1}}function ci(e){return e._strategyHWM-e._queueTotalSize}function Ua(e,t,o){try{Wn(e,t,o)}catch(u){Ut(e,u);return}let l=e._controlledWritableStream;if(!pe(l)&&l._state==="writable"){let u=Jn(e);Un(l,u)}Ar(e)}function Ar(e){let t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){jn(t);return}if(e._queue.length===0)return;let l=ra(e);l===ui?Ma(e):Ja(e,l)}function Ut(e,t){e._controlledWritableStream._state==="writable"&&di(e,t)}function Ma(e){let t=e._controlledWritableStream;Oa(t),Bn(e);let o=e._closeAlgorithm();Er(e),T(o,()=>(Ba(t),null),l=>(Wa(t,l),null))}function Ja(e,t){let o=e._controlledWritableStream;Da(o);let l=e._writeAlgorithm(t);T(l,()=>{va(o);let u=o._state;if(Bn(e),!pe(o)&&u==="writable"){let c=Jn(e);Un(o,c)}return Ar(e),null},u=>(o._state==="writable"&&Er(e),ka(o,u),null))}function Jn(e){return ci(e)<=0}function di(e,t){let o=e._controlledWritableStream;Er(e),$n(o,t)}function vr(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Nn(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function et(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function Mt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function kr(e){e._closedPromise=p((t,o)=>{e._closedPromise_resolve=t,e._closedPromise_reject=o,e._closedPromiseState="pending"})}function hi(e,t){kr(e),Hn(e,t)}function Na(e){kr(e),mi(e)}function Hn(e,t){e._closedPromise_reject!==void 0&&(v(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function Ha(e,t){hi(e,t)}function mi(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function Br(e){e._readyPromise=p((t,o)=>{e._readyPromise_resolve=t,e._readyPromise_reject=o}),e._readyPromiseState="pending"}function Kn(e,t){Br(e),bi(e,t)}function pi(e){Br(e),Vn(e)}function bi(e,t){e._readyPromise_reject!==void 0&&(v(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Ka(e){Br(e)}function Va(e,t){Kn(e,t)}function Vn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function Ya(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Yn=Ya();function Qa(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function Ga(){let e=Yn?.DOMException;return Qa(e)?e:void 0}function Za(){let e=function(o,l){this.message=o||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return a(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let Xa=Ga()||Za();function yi(e,t,o,l,u,c){let d=mt(e),y=ri(t);e._disturbed=!0;let R=!1,S=m(void 0);return p((C,P)=>{let I;if(c!==void 0){if(I=()=>{let _=c.reason!==void 0?c.reason:new Xa("Aborted","AbortError"),E=[];l||E.push(()=>t._state==="writable"?Cr(t,_):m(void 0)),u||E.push(()=>e._state==="readable"?fe(e,_):m(void 0)),K(()=>Promise.all(E.map(D=>D())),!0,_)},c.aborted){I();return}c.addEventListener("abort",I)}function ce(){return p((_,E)=>{function D(G){G?_():W(Rt(),D,E)}D(!1)})}function Rt(){return R?m(!0):W(y._readyPromise,()=>p((_,E)=>{xt(d,{_chunkSteps:D=>{S=W(li(y,D),void 0,r),_(!1)},_closeSteps:()=>_(!0),_errorSteps:E})}))}if(Pe(e,d._closedPromise,_=>(l?ie(!0,_):K(()=>Cr(t,_),!0,_),null)),Pe(t,y._closedPromise,_=>(u?ie(!0,_):K(()=>fe(e,_),!0,_),null)),H(e,d._closedPromise,()=>(o?ie():K(()=>Fa(y)),null)),pe(t)||t._state==="closed"){let _=new TypeError("the destination writable stream closed before all data could be piped to it");u?ie(!0,_):K(()=>fe(e,_),!0,_)}v(ce());function Ne(){let _=S;return W(S,()=>_!==S?Ne():void 0)}function Pe(_,E,D){_._state==="errored"?D(_._storedError):g(E,D)}function H(_,E,D){_._state==="closed"?D():O(E,D)}function K(_,E,D){if(R)return;R=!0,t._state==="writable"&&!pe(t)?O(Ne(),G):G();function G(){return T(_(),()=>Ee(E,D),Tt=>Ee(!0,Tt)),null}}function ie(_,E){R||(R=!0,t._state==="writable"&&!pe(t)?O(Ne(),()=>Ee(_,E)):Ee(_,E))}function Ee(_,E){return ai(y),we(d),c!==void 0&&c.removeEventListener("abort",I),_?P(E):C(void 0),null}})}class Ce{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Wr(this))throw Or("desiredSize");return Qn(this)}close(){if(!Wr(this))throw Or("close");if(!St(this))throw new TypeError("The stream is not in a state that permits close");tt(this)}enqueue(t=void 0){if(!Wr(this))throw Or("enqueue");if(!St(this))throw new TypeError("The stream is not in a state that permits enqueue");return wt(this,t)}error(t=void 0){if(!Wr(this))throw Or("error");ue(this,t)}[Ft](t){ze(this);let o=this._cancelAlgorithm(t);return Ir(this),o}[bn](t){let o=this._controlledReadableStream;if(this._queue.length>0){let l=Bn(this);this._closeRequested&&this._queue.length===0?(Ir(this),Ht(o)):Jt(this),t._chunkSteps(l)}else Eo(o,t),Jt(this)}[yn](){}}Object.defineProperties(Ce.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),a(Ce.prototype.close,"close"),a(Ce.prototype.enqueue,"enqueue"),a(Ce.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ce.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Wr(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Ce}function Jt(e){if(!gi(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();T(o,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Jt(e)),null),l=>(ue(e,l),null))}function gi(e){let t=e._controlledReadableStream;return!St(e)||!e._started?!1:!!(Me(t)&&hr(t)>0||Qn(e)>0)}function Ir(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function tt(e){if(!St(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(Ir(e),Ht(t))}function wt(e,t){if(!St(e))return;let o=e._controlledReadableStream;if(Me(o)&&hr(o)>0)Pn(o,t,!1);else{let l;try{l=e._strategySizeAlgorithm(t)}catch(u){throw ue(e,u),u}try{Wn(e,t,l)}catch(u){throw ue(e,u),u}}Jt(e)}function ue(e,t){let o=e._controlledReadableStream;o._state==="readable"&&(ze(e),Ir(e),Ri(o,t))}function Qn(e){let t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function el(e){return!gi(e)}function St(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function wi(e,t,o,l,u,c,d){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,ze(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=d,t._strategyHWM=c,t._pullAlgorithm=l,t._cancelAlgorithm=u,e._readableStreamController=t;let y=o();T(m(y),()=>(t._started=!0,Jt(t),null),R=>(ue(t,R),null))}function tl(e,t,o,l){let u=Object.create(Ce.prototype),c,d,y;t.start!==void 0?c=()=>t.start(u):c=()=>{},t.pull!==void 0?d=()=>t.pull(u):d=()=>m(void 0),t.cancel!==void 0?y=R=>t.cancel(R):y=()=>m(void 0),wi(e,u,c,d,y,o,l)}function Or(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function rl(e,t){return Qe(e._readableStreamController)?ol(e):nl(e)}function nl(e,t){let o=mt(e),l=!1,u=!1,c=!1,d=!1,y,R,S,C,P,I=p(H=>{P=H});function ce(){return l?(u=!0,m(void 0)):(l=!0,xt(o,{_chunkSteps:K=>{A(()=>{u=!1;let ie=K,Ee=K;c||wt(S._readableStreamController,ie),d||wt(C._readableStreamController,Ee),l=!1,u&&ce()})},_closeSteps:()=>{l=!1,c||tt(S._readableStreamController),d||tt(C._readableStreamController),(!c||!d)&&P(void 0)},_errorSteps:()=>{l=!1}}),m(void 0))}function Rt(H){if(c=!0,y=H,d){let K=Lt([y,R]),ie=fe(e,K);P(ie)}return I}function Ne(H){if(d=!0,R=H,c){let K=Lt([y,R]),ie=fe(e,K);P(ie)}return I}function Pe(){}return S=Nt(Pe,ce,Rt),C=Nt(Pe,ce,Ne),g(o._closedPromise,H=>(ue(S._readableStreamController,H),ue(C._readableStreamController,H),(!c||!d)&&P(void 0),null)),[S,C]}function ol(e){let t=mt(e),o=!1,l=!1,u=!1,c=!1,d=!1,y,R,S,C,P,I=p(_=>{P=_});function ce(_){g(_._closedPromise,E=>(_!==t||(oe(S._readableStreamController,E),oe(C._readableStreamController,E),(!c||!d)&&P(void 0)),null))}function Rt(){Ze(t)&&(we(t),t=mt(e),ce(t)),xt(t,{_chunkSteps:E=>{A(()=>{l=!1,u=!1;let D=E,G=E;if(!c&&!d)try{G=xo(E)}catch(Tt){oe(S._readableStreamController,Tt),oe(C._readableStreamController,Tt),P(fe(e,Tt));return}c||gr(S._readableStreamController,D),d||gr(C._readableStreamController,G),o=!1,l?Pe():u&&H()})},_closeSteps:()=>{o=!1,c||zt(S._readableStreamController),d||zt(C._readableStreamController),S._readableStreamController._pendingPullIntos.length>0&&wr(S._readableStreamController,0),C._readableStreamController._pendingPullIntos.length>0&&wr(C._readableStreamController,0),(!c||!d)&&P(void 0)},_errorSteps:()=>{o=!1}})}function Ne(_,E){xe(t)&&(we(t),t=Qo(e),ce(t));let D=E?C:S,G=E?S:C;Xo(t,_,1,{_chunkSteps:Ct=>{A(()=>{l=!1,u=!1;let Pt=E?d:c;if(E?c:d)Pt||Sr(D._readableStreamController,Ct);else{let qi;try{qi=xo(Ct)}catch(to){oe(D._readableStreamController,to),oe(G._readableStreamController,to),P(fe(e,to));return}Pt||Sr(D._readableStreamController,Ct),gr(G._readableStreamController,qi)}o=!1,l?Pe():u&&H()})},_closeSteps:Ct=>{o=!1;let Pt=E?d:c,jr=E?c:d;Pt||zt(D._readableStreamController),jr||zt(G._readableStreamController),Ct!==void 0&&(Pt||Sr(D._readableStreamController,Ct),!jr&&G._readableStreamController._pendingPullIntos.length>0&&wr(G._readableStreamController,0)),(!Pt||!jr)&&P(void 0)},_errorSteps:()=>{o=!1}})}function Pe(){if(o)return l=!0,m(void 0);o=!0;let _=Fn(S._readableStreamController);return _===null?Rt():Ne(_._view,!1),m(void 0)}function H(){if(o)return u=!0,m(void 0);o=!0;let _=Fn(C._readableStreamController);return _===null?Rt():Ne(_._view,!0),m(void 0)}function K(_){if(c=!0,y=_,d){let E=Lt([y,R]),D=fe(e,E);P(D)}return I}function ie(_){if(d=!0,R=_,c){let E=Lt([y,R]),D=fe(e,E);P(D)}return I}function Ee(){}return S=_i(Ee,Pe,K),C=_i(Ee,H,ie),ce(t),[S,C]}function il(e){return i(e)&&typeof e.getReader<"u"}function sl(e){return il(e)?ll(e.getReader()):al(e)}function al(e){let t,o=Fo(e,"async"),l=r;function u(){let d;try{d=Zs(o)}catch(R){return b(R)}let y=m(d);return F(y,R=>{if(!i(R))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Xs(R))tt(t._readableStreamController);else{let C=ea(R);wt(t._readableStreamController,C)}})}function c(d){let y=o.iterator,R;try{R=pr(y,"return")}catch(P){return b(P)}if(R===void 0)return m(void 0);let S;try{S=x(R,y,[d])}catch(P){return b(P)}let C=m(S);return F(C,P=>{if(!i(P))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return t=Nt(l,u,c,0),t}function ll(e){let t,o=r;function l(){let c;try{c=e.read()}catch(d){return b(d)}return F(c,d=>{if(!i(d))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(d.done)tt(t._readableStreamController);else{let y=d.value;wt(t._readableStreamController,y)}})}function u(c){try{return m(e.cancel(c))}catch(d){return b(d)}}return t=Nt(o,l,u,0),t}function ul(e,t){me(e,t);let o=e,l=o?.autoAllocateChunkSize,u=o?.cancel,c=o?.pull,d=o?.start,y=o?.type;return{autoAllocateChunkSize:l===void 0?void 0:Tn(l,`${t} has member 'autoAllocateChunkSize' that`),cancel:u===void 0?void 0:fl(u,o,`${t} has member 'cancel' that`),pull:c===void 0?void 0:cl(c,o,`${t} has member 'pull' that`),start:d===void 0?void 0:dl(d,o,`${t} has member 'start' that`),type:y===void 0?void 0:hl(y,`${t} has member 'type' that`)}}function fl(e,t,o){return ne(e,o),l=>U(e,t,[l])}function cl(e,t,o){return ne(e,o),l=>U(e,t,[l])}function dl(e,t,o){return ne(e,o),l=>x(e,t,[l])}function hl(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function ml(e,t){return me(e,t),{preventCancel:!!e?.preventCancel}}function Si(e,t){me(e,t);let o=e?.preventAbort,l=e?.preventCancel,u=e?.preventClose,c=e?.signal;return c!==void 0&&pl(c,`${t} has member 'signal' that`),{preventAbort:!!o,preventCancel:!!l,preventClose:!!u,signal:c}}function pl(e,t){if(!Ta(e))throw new TypeError(`${t} is not an AbortSignal.`)}function bl(e,t){me(e,t);let o=e?.readable;_n(o,"readable","ReadableWritablePair"),Cn(o,`${t} has member 'readable' that`);let l=e?.writable;return _n(l,"writable","ReadableWritablePair"),ti(l,`${t} has member 'writable' that`),{readable:o,writable:l}}class J{constructor(t={},o={}){t===void 0?t=null:Co(t,"First parameter");let l=Tr(o,"Second parameter"),u=ul(t,"First parameter");if(Gn(this),u.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let c=jt(l,0);fa(this,u,c)}else{let c=Rr(l),d=jt(l,1);tl(this,u,d,c)}}get locked(){if(!Ue(this))throw rt("locked");return Me(this)}cancel(t=void 0){return Ue(this)?Me(this)?b(new TypeError("Cannot cancel a stream that already has a reader")):fe(this,t):b(rt("cancel"))}getReader(t=void 0){if(!Ue(this))throw rt("getReader");return da(t,"First parameter").mode===void 0?mt(this):Qo(this)}pipeThrough(t,o={}){if(!Ue(this))throw rt("pipeThrough");Se(t,1,"pipeThrough");let l=bl(t,"First parameter"),u=Si(o,"Second parameter");if(Me(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(yt(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let c=yi(this,l.writable,u.preventClose,u.preventAbort,u.preventCancel,u.signal);return v(c),l.readable}pipeTo(t,o={}){if(!Ue(this))return b(rt("pipeTo"));if(t===void 0)return b("Parameter 1 is required in 'pipeTo'.");if(!bt(t))return b(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=Si(o,"Second parameter")}catch(u){return b(u)}return Me(this)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):yt(t)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):yi(this,t,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!Ue(this))throw rt("tee");let t=rl(this);return Lt(t)}values(t=void 0){if(!Ue(this))throw rt("values");let o=ml(t,"First parameter");return Qs(this,o.preventCancel)}[kn](t){return this.values(t)}static from(t){return sl(t)}}Object.defineProperties(J,{from:{enumerable:!0}}),Object.defineProperties(J.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),a(J.from,"from"),a(J.prototype.cancel,"cancel"),a(J.prototype.getReader,"getReader"),a(J.prototype.pipeThrough,"pipeThrough"),a(J.prototype.pipeTo,"pipeTo"),a(J.prototype.tee,"tee"),a(J.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(J.prototype,kn,{value:J.prototype.values,writable:!0,configurable:!0});function Nt(e,t,o,l=1,u=()=>1){let c=Object.create(J.prototype);Gn(c);let d=Object.create(Ce.prototype);return wi(c,d,e,t,o,l,u),c}function _i(e,t,o){let l=Object.create(J.prototype);Gn(l);let u=Object.create(Re.prototype);return Yo(l,u,e,t,o,0,void 0),l}function Gn(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Ue(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof J}function Me(e){return e._reader!==void 0}function fe(e,t){if(e._disturbed=!0,e._state==="closed")return m(void 0);if(e._state==="errored")return b(e._storedError);Ht(e);let o=e._reader;if(o!==void 0&&Ze(o)){let u=o._readIntoRequests;o._readIntoRequests=new B,u.forEach(c=>{c._closeSteps(void 0)})}let l=e._readableStreamController[Ft](t);return F(l,r)}function Ht(e){e._state="closed";let t=e._reader;if(t!==void 0&&(Ro(t),xe(t))){let o=t._readRequests;t._readRequests=new B,o.forEach(l=>{l._closeSteps()})}}function Ri(e,t){e._state="errored",e._storedError=t;let o=e._reader;o!==void 0&&(Sn(o,t),xe(o)?vo(o,t):ei(o,t))}function rt(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Ti(e,t){me(e,t);let o=e?.highWaterMark;return _n(o,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Rn(o)}}let Ci=e=>e.byteLength;a(Ci,"size");class Dr{constructor(t){Se(t,1,"ByteLengthQueuingStrategy"),t=Ti(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!Ei(this))throw Pi("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Ei(this))throw Pi("size");return Ci}}Object.defineProperties(Dr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Pi(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Ei(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof Dr}let Ai=()=>1;a(Ai,"size");class qr{constructor(t){Se(t,1,"CountQueuingStrategy"),t=Ti(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!ki(this))throw vi("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!ki(this))throw vi("size");return Ai}}Object.defineProperties(qr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(qr.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function vi(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function ki(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof qr}function yl(e,t){me(e,t);let o=e?.cancel,l=e?.flush,u=e?.readableType,c=e?.start,d=e?.transform,y=e?.writableType;return{cancel:o===void 0?void 0:_l(o,e,`${t} has member 'cancel' that`),flush:l===void 0?void 0:gl(l,e,`${t} has member 'flush' that`),readableType:u,start:c===void 0?void 0:wl(c,e,`${t} has member 'start' that`),transform:d===void 0?void 0:Sl(d,e,`${t} has member 'transform' that`),writableType:y}}function gl(e,t,o){return ne(e,o),l=>U(e,t,[l])}function wl(e,t,o){return ne(e,o),l=>x(e,t,[l])}function Sl(e,t,o){return ne(e,o),(l,u)=>U(e,t,[l,u])}function _l(e,t,o){return ne(e,o),l=>U(e,t,[l])}class Fr{constructor(t={},o={},l={}){t===void 0&&(t=null);let u=Tr(o,"Second parameter"),c=Tr(l,"Third parameter"),d=yl(t,"First parameter");if(d.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(d.writableType!==void 0)throw new RangeError("Invalid writableType specified");let y=jt(c,0),R=Rr(c),S=jt(u,1),C=Rr(u),P,I=p(ce=>{P=ce});Rl(this,I,S,C,y,R),Cl(this,d),d.start!==void 0?P(d.start(this._transformStreamController)):P(void 0)}get readable(){if(!Bi(this))throw Di("readable");return this._readable}get writable(){if(!Bi(this))throw Di("writable");return this._writable}}Object.defineProperties(Fr.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Fr.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Rl(e,t,o,l,u,c){function d(){return t}function y(I){return Al(e,I)}function R(I){return vl(e,I)}function S(){return kl(e)}e._writable=Ea(d,y,S,R,o,l);function C(){return Bl(e)}function P(I){return Wl(e,I)}e._readable=Nt(d,C,P,u,c),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,xr(e,!0),e._transformStreamController=void 0}function Bi(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof Fr}function Wi(e,t){ue(e._readable._readableStreamController,t),Zn(e,t)}function Zn(e,t){zr(e._transformStreamController),Ut(e._writable._writableStreamController,t),Xn(e)}function Xn(e){e._backpressure&&xr(e,!1)}function xr(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=p(o=>{e._backpressureChangePromise_resolve=o}),e._backpressure=t}class Je{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Lr(this))throw $r("desiredSize");let t=this._controlledTransformStream._readable._readableStreamController;return Qn(t)}enqueue(t=void 0){if(!Lr(this))throw $r("enqueue");Ii(this,t)}error(t=void 0){if(!Lr(this))throw $r("error");Pl(this,t)}terminate(){if(!Lr(this))throw $r("terminate");El(this)}}Object.defineProperties(Je.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),a(Je.prototype.enqueue,"enqueue"),a(Je.prototype.error,"error"),a(Je.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Je.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Lr(e){return!i(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof Je}function Tl(e,t,o,l,u){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=o,t._flushAlgorithm=l,t._cancelAlgorithm=u,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}function Cl(e,t){let o=Object.create(Je.prototype),l,u,c;t.transform!==void 0?l=d=>t.transform(d,o):l=d=>{try{return Ii(o,d),m(void 0)}catch(y){return b(y)}},t.flush!==void 0?u=()=>t.flush(o):u=()=>m(void 0),t.cancel!==void 0?c=d=>t.cancel(d):c=()=>m(void 0),Tl(e,o,l,u,c)}function zr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function Ii(e,t){let o=e._controlledTransformStream,l=o._readable._readableStreamController;if(!St(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{wt(l,t)}catch(c){throw Zn(o,c),o._readable._storedError}el(l)!==o._backpressure&&xr(o,!0)}function Pl(e,t){Wi(e._controlledTransformStream,t)}function Oi(e,t){let o=e._transformAlgorithm(t);return F(o,void 0,l=>{throw Wi(e._controlledTransformStream,l),l})}function El(e){let t=e._controlledTransformStream,o=t._readable._readableStreamController;tt(o);let l=new TypeError("TransformStream terminated");Zn(t,l)}function Al(e,t){let o=e._transformStreamController;if(e._backpressure){let l=e._backpressureChangePromise;return F(l,()=>{let u=e._writable;if(u._state==="erroring")throw u._storedError;return Oi(o,t)})}return Oi(o,t)}function vl(e,t){let o=e._transformStreamController;if(o._finishPromise!==void 0)return o._finishPromise;let l=e._readable;o._finishPromise=p((c,d)=>{o._finishPromise_resolve=c,o._finishPromise_reject=d});let u=o._cancelAlgorithm(t);return zr(o),T(u,()=>(l._state==="errored"?_t(o,l._storedError):(ue(l._readableStreamController,t),eo(o)),null),c=>(ue(l._readableStreamController,c),_t(o,c),null)),o._finishPromise}function kl(e){let t=e._transformStreamController;if(t._finishPromise!==void 0)return t._finishPromise;let o=e._readable;t._finishPromise=p((u,c)=>{t._finishPromise_resolve=u,t._finishPromise_reject=c});let l=t._flushAlgorithm();return zr(t),T(l,()=>(o._state==="errored"?_t(t,o._storedError):(tt(o._readableStreamController),eo(t)),null),u=>(ue(o._readableStreamController,u),_t(t,u),null)),t._finishPromise}function Bl(e){return xr(e,!1),e._backpressureChangePromise}function Wl(e,t){let o=e._transformStreamController;if(o._finishPromise!==void 0)return o._finishPromise;let l=e._writable;o._finishPromise=p((c,d)=>{o._finishPromise_resolve=c,o._finishPromise_reject=d});let u=o._cancelAlgorithm(t);return zr(o),T(u,()=>(l._state==="errored"?_t(o,l._storedError):(Ut(l._writableStreamController,t),Xn(e),eo(o)),null),c=>(Ut(l._writableStreamController,c),Xn(e),_t(o,c),null)),o._finishPromise}function $r(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function eo(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function _t(e,t){e._finishPromise_reject!==void 0&&(v(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Di(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=Dr,n.CountQueuingStrategy=qr,n.ReadableByteStreamController=Re,n.ReadableStream=J,n.ReadableStreamBYOBReader=$e,n.ReadableStreamBYOBRequest=Ye,n.ReadableStreamDefaultController=Ce,n.ReadableStreamDefaultReader=Fe,n.TransformStream=Fr,n.TransformStreamDefaultController=Je,n.WritableStream=je,n.WritableStreamDefaultController=gt,n.WritableStreamDefaultWriter=Te})});var is=ro(()=>{if(!globalThis.ReadableStream)try{let n=require("process"),{emitWarning:r}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("stream/web")),n.emitWarning=r}catch(i){throw n.emitWarning=r,i}}catch{Object.assign(globalThis,os())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(i){let s=0,a=this;return new ReadableStream({type:"bytes",async pull(f){let w=await a.slice(s,Math.min(a.size,s+65536)).arrayBuffer();s+=w.byteLength,f.enqueue(new Uint8Array(w)),s===a.size&&f.close()}})})}catch{}});async function*fo(n,r=!0){for(let i of n)if("stream"in i)yield*i.stream();else if(ArrayBuffer.isView(i))if(r){let s=i.byteOffset,a=i.byteOffset+i.byteLength;for(;s!==a;){let f=Math.min(a-s,ss),h=i.buffer.slice(s,s+f);s+=h.byteLength,yield new Uint8Array(h)}}else yield i;else{let s=0,a=i;for(;s!==a.size;){let h=await a.slice(s,Math.min(a.size,s+ss)).arrayBuffer();s+=h.byteLength,yield new Uint8Array(h)}}}var Tf,ss,We,rr,It,on,lt,as,Gl,Ie,nr=Kt(()=>{Tf=He(is(),1);ss=65536;as=(lt=class{constructor(r=[],i={}){de(this,We,[]);de(this,rr,"");de(this,It,0);de(this,on,"transparent");if(typeof r!="object"||r===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof r[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof i!="object"&&typeof i!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");i===null&&(i={});let s=new TextEncoder;for(let f of r){let h;ArrayBuffer.isView(f)?h=new Uint8Array(f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)):f instanceof ArrayBuffer?h=new Uint8Array(f.slice(0)):f instanceof lt?h=f:h=s.encode(`${f}`),Z(this,It,z(this,It)+(ArrayBuffer.isView(h)?h.byteLength:h.size)),z(this,We).push(h)}Z(this,on,`${i.endings===void 0?"transparent":i.endings}`);let a=i.type===void 0?"":String(i.type);Z(this,rr,/^[\x20-\x7E]*$/.test(a)?a:"")}get size(){return z(this,It)}get type(){return z(this,rr)}async text(){let r=new TextDecoder,i="";for await(let s of fo(z(this,We),!1))i+=r.decode(s,{stream:!0});return i+=r.decode(),i}async arrayBuffer(){let r=new Uint8Array(this.size),i=0;for await(let s of fo(z(this,We),!1))r.set(s,i),i+=s.length;return r.buffer}stream(){let r=fo(z(this,We),!0);return new globalThis.ReadableStream({type:"bytes",async pull(i){let s=await r.next();s.done?i.close():i.enqueue(s.value)},async cancel(){await r.return()}})}slice(r=0,i=this.size,s=""){let{size:a}=this,f=r<0?Math.max(a+r,0):Math.min(r,a),h=i<0?Math.max(a+i,0):Math.min(i,a),w=Math.max(h-f,0),p=z(this,We),m=[],b=0;for(let T of p){if(b>=w)break;let O=ArrayBuffer.isView(T)?T.byteLength:T.size;if(f&&O<=f)f-=O,h-=O;else{let g;ArrayBuffer.isView(T)?(g=T.subarray(f,Math.min(O,h)),b+=g.byteLength):(g=T.slice(f,Math.min(O,h)),b+=g.size),h-=O,m.push(g),f=0}}let W=new lt([],{type:String(s).toLowerCase()});return Z(W,It,w),Z(W,We,m),W}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](r){return r&&typeof r=="object"&&typeof r.constructor=="function"&&(typeof r.stream=="function"||typeof r.arrayBuffer=="function")&&/^(Blob|File)$/.test(r[Symbol.toStringTag])}},We=new WeakMap,rr=new WeakMap,It=new WeakMap,on=new WeakMap,lt);Object.defineProperties(as.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Gl=as,Ie=Gl});var or,ir,ls,Zl,Xl,Ot,co=Kt(()=>{nr();Zl=(ls=class extends Ie{constructor(i,s,a={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(i,a);de(this,or,0);de(this,ir,"");a===null&&(a={});let f=a.lastModified===void 0?Date.now():Number(a.lastModified);Number.isNaN(f)||Z(this,or,f),Z(this,ir,String(s))}get name(){return z(this,ir)}get lastModified(){return z(this,or)}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](i){return!!i&&i instanceof Ie&&/^(File)$/.test(i[Symbol.toStringTag])}},or=new WeakMap,ir=new WeakMap,ls),Xl=Zl,Ot=Xl});function ds(n,r=Ie){var i=`${us()}${us()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],a=`--${i}\r
Content-Disposition: form-data; name="`;return n.forEach((f,h)=>typeof f=="string"?s.push(a+ho(h)+`"\r
\r
${f.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):s.push(a+ho(h)+`"; filename="${ho(f.name,1)}"\r
Content-Type: ${f.type||"application/octet-stream"}\r
\r
`,f,`\r
`)),s.push(`--${i}--`),new r(s,{type:"multipart/form-data; boundary="+i})}var sr,eu,tu,us,ru,fs,ho,ut,se,cs,ft,sn=Kt(()=>{nr();co();({toStringTag:sr,iterator:eu,hasInstance:tu}=Symbol),us=Math.random,ru="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),fs=(n,r,i)=>(n+="",/^(Blob|File)$/.test(r&&r[sr])?[(i=i!==void 0?i+"":r[sr]=="File"?r.name:"blob",n),r.name!==i||r[sr]=="blob"?new Ot([r],i,r):r]:[n,r+""]),ho=(n,r)=>(r?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),ut=(n,r,i)=>{if(r.length<i)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${i} arguments required, but only ${r.length} present.`)},ft=(cs=class{constructor(...r){de(this,se,[]);if(r.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[sr](){return"FormData"}[eu](){return this.entries()}static[tu](r){return r&&typeof r=="object"&&r[sr]==="FormData"&&!ru.some(i=>typeof r[i]!="function")}append(...r){ut("append",arguments,2),z(this,se).push(fs(...r))}delete(r){ut("delete",arguments,1),r+="",Z(this,se,z(this,se).filter(([i])=>i!==r))}get(r){ut("get",arguments,1),r+="";for(var i=z(this,se),s=i.length,a=0;a<s;a++)if(i[a][0]===r)return i[a][1];return null}getAll(r,i){return ut("getAll",arguments,1),i=[],r+="",z(this,se).forEach(s=>s[0]===r&&i.push(s[1])),i}has(r){return ut("has",arguments,1),r+="",z(this,se).some(i=>i[0]===r)}forEach(r,i){ut("forEach",arguments,1);for(var[s,a]of this)r.call(i,a,s,this)}set(...r){ut("set",arguments,2);var i=[],s=!0;r=fs(...r),z(this,se).forEach(a=>{a[0]===r[0]?s&&(s=!i.push(r)):i.push(a)}),s&&i.push(r),Z(this,se,i)}*entries(){yield*z(this,se)}*keys(){for(var[r]of this)yield r}*values(){for(var[,r]of this)yield r}},se=new WeakMap,cs)});var ys=ro((zf,bs)=>{if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),r=new n().port1,i=new ArrayBuffer;r.postMessage(i,[i,i])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}bs.exports=globalThis.DOMException});var ln,nu,Uf,po=Kt(()=>{ln=require("fs"),nu=He(ys(),1);co();nr();({stat:Uf}=ln.promises)});var ws={};xi(ws,{toFormData:()=>fu});function uu(n){let r=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!r)return;let i=r[2]||r[3]||"",s=i.slice(i.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,(a,f)=>String.fromCharCode(f)),s}async function fu(n,r){if(!/multipart/i.test(r))throw new TypeError("Failed to fetch");let i=r.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!i)throw new TypeError("no or bad content-type header, no multipart boundary");let s=new bo(i[1]||i[2]),a,f,h,w,p,m,b=[],W=new ft,T=A=>{h+=v.decode(A,{stream:!0})},O=A=>{b.push(A)},g=()=>{let A=new Ot(b,m,{type:p});W.append(w,A)},F=()=>{W.append(w,h)},v=new TextDecoder("utf-8");v.decode(),s.onPartBegin=function(){s.onPartData=T,s.onPartEnd=F,a="",f="",h="",w="",p="",m=null,b.length=0},s.onHeaderField=function(A){a+=v.decode(A,{stream:!0})},s.onHeaderValue=function(A){f+=v.decode(A,{stream:!0})},s.onHeaderEnd=function(){if(f+=v.decode(),a=a.toLowerCase(),a==="content-disposition"){let A=f.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);A&&(w=A[2]||A[3]||""),m=uu(f),m&&(s.onPartData=O,s.onPartEnd=g)}else a==="content-type"&&(p=f);f="",a=""};for await(let A of n)s.write(A);return s.end(),W}var ye,q,gs,Ve,un,fn,ou,lr,iu,su,au,lu,ct,bo,Ss=Kt(()=>{po();sn();ye=0,q={START_BOUNDARY:ye++,HEADER_FIELD_START:ye++,HEADER_FIELD:ye++,HEADER_VALUE_START:ye++,HEADER_VALUE:ye++,HEADER_VALUE_ALMOST_DONE:ye++,HEADERS_ALMOST_DONE:ye++,PART_DATA_START:ye++,PART_DATA:ye++,END:ye++},gs=1,Ve={PART_BOUNDARY:gs,LAST_BOUNDARY:gs*=2},un=10,fn=13,ou=32,lr=45,iu=58,su=97,au=122,lu=n=>n|32,ct=()=>{},bo=class{constructor(r){this.index=0,this.flags=0,this.onHeaderEnd=ct,this.onHeaderField=ct,this.onHeadersEnd=ct,this.onHeaderValue=ct,this.onPartBegin=ct,this.onPartData=ct,this.onPartEnd=ct,this.boundaryChars={},r=`\r
--`+r;let i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s),this.boundaryChars[i[s]]=!0;this.boundary=i,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=q.START_BOUNDARY}write(r){let i=0,s=r.length,a=this.index,{lookbehind:f,boundary:h,boundaryChars:w,index:p,state:m,flags:b}=this,W=this.boundary.length,T=W-1,O=r.length,g,F,v=k=>{this[k+"Mark"]=i},A=k=>{delete this[k+"Mark"]},x=(k,B,L,qe)=>{(B===void 0||B!==L)&&this[k](qe&&qe.subarray(B,L))},U=(k,B)=>{let L=k+"Mark";L in this&&(B?(x(k,this[L],i,r),delete this[L]):(x(k,this[L],r.length,r),this[L]=0))};for(i=0;i<s;i++)switch(g=r[i],m){case q.START_BOUNDARY:if(p===h.length-2){if(g===lr)b|=Ve.LAST_BOUNDARY;else if(g!==fn)return;p++;break}else if(p-1===h.length-2){if(b&Ve.LAST_BOUNDARY&&g===lr)m=q.END,b=0;else if(!(b&Ve.LAST_BOUNDARY)&&g===un)p=0,x("onPartBegin"),m=q.HEADER_FIELD_START;else return;break}g!==h[p+2]&&(p=-2),g===h[p+2]&&p++;break;case q.HEADER_FIELD_START:m=q.HEADER_FIELD,v("onHeaderField"),p=0;case q.HEADER_FIELD:if(g===fn){A("onHeaderField"),m=q.HEADERS_ALMOST_DONE;break}if(p++,g===lr)break;if(g===iu){if(p===1)return;U("onHeaderField",!0),m=q.HEADER_VALUE_START;break}if(F=lu(g),F<su||F>au)return;break;case q.HEADER_VALUE_START:if(g===ou)break;v("onHeaderValue"),m=q.HEADER_VALUE;case q.HEADER_VALUE:g===fn&&(U("onHeaderValue",!0),x("onHeaderEnd"),m=q.HEADER_VALUE_ALMOST_DONE);break;case q.HEADER_VALUE_ALMOST_DONE:if(g!==un)return;m=q.HEADER_FIELD_START;break;case q.HEADERS_ALMOST_DONE:if(g!==un)return;x("onHeadersEnd"),m=q.PART_DATA_START;break;case q.PART_DATA_START:m=q.PART_DATA,v("onPartData");case q.PART_DATA:if(a=p,p===0){for(i+=T;i<O&&!(r[i]in w);)i+=W;i-=T,g=r[i]}if(p<h.length)h[p]===g?(p===0&&U("onPartData",!0),p++):p=0;else if(p===h.length)p++,g===fn?b|=Ve.PART_BOUNDARY:g===lr?b|=Ve.LAST_BOUNDARY:p=0;else if(p-1===h.length)if(b&Ve.PART_BOUNDARY){if(p=0,g===un){b&=~Ve.PART_BOUNDARY,x("onPartEnd"),x("onPartBegin"),m=q.HEADER_FIELD_START;break}}else b&Ve.LAST_BOUNDARY&&g===lr?(x("onPartEnd"),m=q.END,b=0):p=0;if(p>0)f[p-1]=g;else if(a>0){let k=new Uint8Array(f.buffer,f.byteOffset,f.byteLength);x("onPartData",0,a,k),a=0,v("onPartData"),i--}break;case q.END:break;default:throw new Error(`Unexpected state entered: ${m}`)}U("onHeaderField"),U("onHeaderValue"),U("onPartData"),this.index=p,this.state=m,this.flags=b}end(){if(this.state===q.HEADER_FIELD_START&&this.index===0||this.state===q.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==q.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var Pu={};xi(Pu,{handler:()=>Ru});module.exports=xl(Pu);var X=class extends Error{},be=class extends X{constructor(r,i,s){super(r),this.failedAssertion={actual:i,expected:s}}},$=class extends X{constructor(r,i){let s=i!=null?`${r}: ${i}`:r;super(s)}},M=class extends X{},Vt=class extends X{},Yt=class extends be{},N=class extends be{withRawJwt({header:r,payload:i}){return this.rawJwt={header:r,payload:i},this}},Et=class extends N{},Mr=class extends N{},Jr=class extends N{},Nr=class extends N{},Hr=class extends N{},Kr=class extends N{},Qt=class extends N{},Gt=class extends N{};var nt=class extends X{},Ae=class extends X{},At=class extends X{},Ke=class extends X{},Vr=class extends X{},Yr=class extends X{},Qr=class extends be{},Gr=class extends be{},ve=class extends X{constructor(r,i){super(`Failed to fetch ${r}: ${i}`)}},ke=class extends ve{};var kt=require("crypto");var ot;(function(n){n[n.Universal=0]="Universal"})(ot||(ot={}));var it;(function(n){n[n.Primitive=0]="Primitive",n[n.Constructed=1]="Constructed"})(it||(it={}));var st;(function(n){n[n.BitString=3]="BitString",n[n.ObjectIdentifier=6]="ObjectIdentifier",n[n.Sequence=16]="Sequence",n[n.Null=5]="Null",n[n.Integer=2]="Integer"})(st||(st={}));function Zt(n){let r=n.class<<7|n.primitiveOrConstructed<<5|n.tag;return Buffer.from([r])}function Xt(n){if(n<128)return Buffer.from([n]);let r=[];for(;n>0;)r.push(n%256),n=n>>8;return r.reverse(),Buffer.from([128|r.length,...r])}function $i(n){return n[0]>>7&&(n=Buffer.concat([Buffer.from([0]),n])),Buffer.concat([Zt({class:ot.Universal,primitiveOrConstructed:it.Primitive,tag:st.Integer}),Xt(n.length),n])}function Ll(n){let r=n.split(".").map(f=>parseInt(f)),i=r[0]*40+r[1],s=r.slice(2).reduce((f,h)=>{let w=[];do w.push(h%128),h=h>>7;while(h);return f.concat(w.map((p,m)=>m?p+128:p).reverse())},[]),a=Buffer.from([i,...s]);return Buffer.concat([Zt({class:ot.Universal,primitiveOrConstructed:it.Primitive,tag:st.ObjectIdentifier}),Xt(a.length),a])}function zl(n){let r=Buffer.concat([Buffer.from([0]),n]);return Buffer.concat([Zt({class:ot.Universal,primitiveOrConstructed:it.Primitive,tag:st.BitString}),Xt(r.length),r])}function no(n){let r=Buffer.concat(n);return Buffer.concat([Zt({class:ot.Universal,primitiveOrConstructed:it.Constructed,tag:st.Sequence}),Xt(r.length),r])}function $l(){return Buffer.concat([Zt({class:ot.Universal,primitiveOrConstructed:it.Primitive,tag:st.Null}),Xt(0)])}var jl=no([Ll("1.2.840.113549.1.1.1"),$l()]);function oo(n,r){return no([jl,zl(no([$i(n),$i(r)]))])}var Ui=require("https");function ji(n,r,i){if(r===429)throw new ve(n,"Too many requests");if(r!==200)throw new ke(n,`Status code is ${r}, expected 200`);if(!i||!i.toLowerCase().startsWith("application/json"))throw new ke(n,`Content-type is "${i}", expected "application/json"`)}var Mi=require("stream"),Ji=require("util");function vt(n){return typeof n=="object"&&!Array.isArray(n)&&n!==null}function er(n){return JSON.parse(n,(r,i)=>(typeof i=="object"&&!Array.isArray(i)&&i!==null&&(delete i.__proto__,delete i.constructor),i))}async function Ni(n,r,i){let s;return new Promise((a,f)=>{let h=(0,Ui.request)(n,{method:"GET",...r},p=>{(0,Mi.pipeline)([p,Ul(n,p.statusCode,p.headers)],w)});r?.responseTimeout&&(s=setTimeout(()=>w(new ve(n,`Response time-out (after ${r.responseTimeout} ms.)`)),r.responseTimeout),s.unref());function w(...p){if(s&&clearTimeout(s),p[0]==null){a(p[1]);return}h.socket?.emit("agentRemove");let m=p[0];m instanceof ve||(m=new ve(n,m.message)),h.destroy(),f(m)}h.on("error",w),h.end(i)})}function Ul(n,r,i){return async s=>{ji(n,r,i["content-type"]);let a=[];for await(let f of s)a.push(f);try{return er(new Ji.TextDecoder("utf8",{fatal:!0,ignoreBOM:!0}).decode(Buffer.concat(a)))}catch(f){throw new ke(n,f)}}}var Zr;(function(n){n.RS256="RSA-SHA256",n.RS384="RSA-SHA384",n.RS512="RSA-SHA512"})(Zr||(Zr={}));var V={fetchJson:Ni,transformJwkToKeyObjectSync:n=>(0,kt.createPublicKey)({key:oo(Buffer.from(n.n,"base64"),Buffer.from(n.e,"base64")),format:"der",type:"spki"}),transformJwkToKeyObjectAsync:async n=>(0,kt.createPublicKey)({key:oo(Buffer.from(n.n,"base64"),Buffer.from(n.e,"base64")),format:"der",type:"spki"}),parseB64UrlString:n=>Buffer.from(n,"base64").toString("utf8"),verifySignatureSync:({alg:n,keyObject:r,jwsSigningInput:i,signature:s})=>(0,kt.createVerify)(Zr[n]).update(i).verify(r,s,"base64"),verifySignatureAsync:async({alg:n,keyObject:r,jwsSigningInput:i,signature:s})=>(0,kt.createVerify)(Zr[n]).update(i).verify(r,s,"base64"),defaultFetchTimeouts:{socketIdle:500,response:1500},setTimeoutUnref:(...n)=>setTimeout(...n).unref()};var Xr=V.fetchJson,en=class{constructor(r){this.defaultRequestOptions={timeout:V.defaultFetchTimeouts.socketIdle,responseTimeout:V.defaultFetchTimeouts.response,...r?.defaultRequestOptions}}async fetch(r,i,s){i={...this.defaultRequestOptions,...i};try{return await Xr(r,i,s)}catch(a){if(a instanceof ke)throw a;return Xr(r,i,s)}}};function at(n,r,i,s=be){if(!r)throw new s(`Missing ${n}. Expected: ${i}`,r,i);if(typeof r!="string")throw new s(`${n} is not of type string`,r,i);if(i!==r)throw new s(`${n} not allowed: ${r}. Expected: ${i}`,r,i)}function Be(n,r,i,s=be){if(!r)throw new s(`Missing ${n}. ${io(i)}`,r,i);if(typeof r!="string")throw new s(`${n} is not of type string`,r,i);return Bt(n,r,i,s)}function Bt(n,r,i,s=be){if(!r)throw new s(`Missing ${n}. ${io(i)}`,r,i);let a=new Set(Array.isArray(i)?i:[i]);if(typeof r=="string"&&(r=[r]),!Array.isArray(r))throw new s(`${n} is not an array`,r,i);if(!r.some(h=>{if(typeof h!="string")throw new s(`${n} includes elements that are not of type string`,r,i);return a.has(h)}))throw new s(`${n} not allowed: ${r.join(", ")}. ${io(i)}`,r,i)}function io(n){return Array.isArray(n)?n.length>1?`Expected one of: ${n.join(", ")}`:`Expected: ${n[0]}`:`Expected: ${n}`}function Hi(n,r){if(n&&typeof n.then=="function")throw r()}var Ml=["use","alg","kid","n","e"],Jl=["kty"];function Wt(n,r){return n.keys.find(i=>i.kid!=null&&i.kid===r)}async function Nl(n){let r=await Xr(n);return ao(r),r}async function Ki(n,r){if(!r.header.kid)throw new At("JWT header does not have valid kid claim");let i=await Nl(n),s=Wt(i,r.header.kid);if(!s)throw new Ke(`JWK for kid "${r.header.kid}" not found in the JWKS`);return s}function ao(n){if(!n)throw new nt("JWKS empty");if(!vt(n))throw new nt("JWKS should be an object");if(!Object.keys(n).includes("keys"))throw new nt("JWKS does not include keys");if(!Array.isArray(n.keys))throw new nt("JWKS keys should be an array");for(let r of n.keys)Yi(r)}function Vi(n){if(at("JWK use",n.use,"sig",Qr),at("JWK kty",n.kty,"RSA",Gr),!n.n)throw new Ae("Missing modulus (n)");if(!n.e)throw new Ae("Missing exponent (e)")}function Yi(n){if(!n)throw new Ae("JWK empty");if(!vt(n))throw new Ae("JWK should be an object");for(let r of Jl)if(typeof n[r]!="string")throw new Ae(`JWK ${r} should be a string`);for(let r of Ml)if(r in n&&typeof n[r]!="string")throw new Ae(`JWK ${r} should be a string`)}function Qi(n){try{return ao(n),!0}catch{return!1}}function Gi(n){try{return Yi(n),!0}catch{return!1}}var so=class{constructor(r){this.waitingUris=new Map,this.waitSeconds=r?.waitSeconds??10}async wait(r){if(this.waitingUris.has(r))throw new Vr("Not allowed to fetch JWKS yet, still waiting for back off period to end")}release(r){let i=this.waitingUris.get(r);i&&(clearTimeout(i),this.waitingUris.delete(r))}registerFailedAttempt(r){let i=V.setTimeoutUnref(()=>{this.waitingUris.delete(r)},this.waitSeconds*1e3);this.waitingUris.set(r,i)}registerSuccessfulAttempt(r){this.release(r)}},tn=class{constructor(r){this.jwksCache=new Map,this.fetchingJwks=new Map,this.penaltyBox=r?.penaltyBox??new so,this.fetcher=r?.fetcher??new en}addJwks(r,i){this.jwksCache.set(r,i)}async getJwks(r){let i=this.fetchingJwks.get(r);if(i)return i;let s=this.fetcher.fetch(r).then(f=>(ao(f),f));this.fetchingJwks.set(r,s);let a;try{a=await s}finally{this.fetchingJwks.delete(r)}return this.jwksCache.set(r,a),a}getCachedJwk(r,i){if(typeof i.header.kid!="string")throw new At("JWT header does not have valid kid claim");if(!this.jwksCache.has(r))throw new Yr(`JWKS for uri ${r} not yet available in cache`);let s=Wt(this.jwksCache.get(r),i.header.kid);if(!s)throw new Ke(`JWK for kid ${i.header.kid} not found in the JWKS`);return s}async getJwk(r,i){if(typeof i.header.kid!="string")throw new At("JWT header does not have valid kid claim");let s=this.jwksCache.get(r);if(s){let h=Wt(s,i.header.kid);if(h)return h}await this.penaltyBox.wait(r,i.header.kid);let a=await this.getJwks(r),f=Wt(a,i.header.kid);if(f)this.penaltyBox.registerSuccessfulAttempt(r,i.header.kid);else throw this.penaltyBox.registerFailedAttempt(r,i.header.kid),new Ke(`JWK for kid "${i.header.kid}" not found in the JWKS`);return f}};var Zi=["RS256","RS384","RS512"];function Hl(n){if(!vt(n))throw new $("JWT header is not an object");if(n.alg!==void 0&&typeof n.alg!="string")throw new $("JWT header alg claim is not a string");if(n.kid!==void 0&&typeof n.kid!="string")throw new $("JWT header kid claim is not a string")}function Kl(n){if(!vt(n))throw new $("JWT payload is not an object");if(n.exp!==void 0&&!Number.isFinite(n.exp))throw new $("JWT payload exp claim is not a number");if(n.iss!==void 0&&typeof n.iss!="string")throw new $("JWT payload iss claim is not a string");if(n.sub!==void 0&&typeof n.sub!="string")throw new $("JWT payload sub claim is not a string");if(n.aud!==void 0&&typeof n.aud!="string"&&(!Array.isArray(n.aud)||n.aud.some(r=>typeof r!="string")))throw new $("JWT payload aud claim is not a string or array of strings");if(n.nbf!==void 0&&!Number.isFinite(n.nbf))throw new $("JWT payload nbf claim is not a number");if(n.iat!==void 0&&!Number.isFinite(n.iat))throw new $("JWT payload iat claim is not a number");if(n.scope!==void 0&&typeof n.scope!="string")throw new $("JWT payload scope claim is not a string");if(n.jti!==void 0&&typeof n.jti!="string")throw new $("JWT payload jti claim is not a string")}function Xi(n){if(!n)throw new $("Empty JWT");if(typeof n!="string")throw new $("JWT is not a string");if(!n.match(/^[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+$/))throw new $("JWT string does not consist of exactly 3 parts (header, payload, signature)");let[r,i,s]=n.split("."),[a,f]=[r,i].map(V.parseB64UrlString),h;try{h=er(a)}catch(p){throw new $("Invalid JWT. Header is not a valid JSON object",p)}Hl(h);let w;try{w=er(f)}catch(p){throw new $("Invalid JWT. Payload is not a valid JSON object",p)}return Kl(w),{header:h,headerB64:r,payload:w,payloadB64:i,signatureB64:s}}function lo(n,r){if(n.exp!==void 0&&n.exp+(r.graceSeconds??0)<Date.now()/1e3)throw new Nr(`Token expired at ${new Date(n.exp*1e3).toISOString()}`,n.exp);if(n.nbf!==void 0&&n.nbf-(r.graceSeconds??0)>Date.now()/1e3)throw new Hr(`Token can't be used before ${new Date(n.nbf*1e3).toISOString()}`,n.nbf);if(r.issuer!==null){if(r.issuer===void 0)throw new M("issuer must be provided or set to null explicitly");Be("Issuer",n.iss,r.issuer,Et)}if(r.audience!==null){if(r.audience===void 0)throw new M("audience must be provided or set to null explicitly");Bt("Audience",n.aud,r.audience,Mr)}r.scope!=null&&Bt("Scope",n.scope?.split(" "),r.scope,Jr)}function es(n,r){Vi(r),r.alg&&at("JWT signature algorithm",n.alg,r.alg,Yt),Be("JWT signature algorithm",n.alg,Zi,Yt)}async function Vl(n,r,i,s=Ki,a=V.transformJwkToKeyObjectAsync){let{header:f,headerB64:h,payload:w,payloadB64:p,signatureB64:m}=n,b=await s(r,n);es(n.header,b);let W=await a(b,f.alg,w.iss);if(!await V.verifySignatureAsync({jwsSigningInput:`${h}.${p}`,signature:m,alg:f.alg,keyObject:W}))throw new Vt("Invalid signature");try{lo(w,i),i.customJwtCheck&&await i.customJwtCheck({header:f,payload:w,jwk:b})}catch(O){throw i.includeRawJwtInErrors&&O instanceof N?O.withRawJwt(n):O}return w}function Yl(n,r,i,s){let{header:a,headerB64:f,payload:h,payloadB64:w,signatureB64:p}=n,m;if(Gi(r))m=r;else if(Qi(r)){let T=a.kid?Wt(r,a.kid):void 0;if(!T)throw new Ke(`JWK for kid ${a.kid} not found in the JWKS`);m=T}else throw new M([`Expected a valid JWK or JWKS (parsed as JavaScript object), but received: ${r}.`,"If you're passing a JWKS URI, use the async verify() method instead, it will download and parse the JWKS for you"].join());es(n.header,m);let b=s(m,a.alg,h.iss);if(!V.verifySignatureSync({jwsSigningInput:`${f}.${w}`,signature:p,alg:a.alg,keyObject:b}))throw new Vt("Invalid signature");try{if(lo(h,i),i.customJwtCheck){let T=i.customJwtCheck({header:a,payload:h,jwk:m});Hi(T,()=>new M("Custom JWT checks must be synchronous but a promise was returned"))}}catch(T){throw i.includeRawJwtInErrors&&T instanceof N?T.withRawJwt(n):T}return h}var rn=class{constructor(r,i=new tn){if(this.jwksCache=i,this.issuersConfig=new Map,this.publicKeyCache=new uo,Array.isArray(r)){if(!r.length)throw new M("Provide at least one issuer configuration");for(let s of r){if(this.issuersConfig.has(s.issuer))throw new M(`issuer ${s.issuer} supplied multiple times`);this.issuersConfig.set(s.issuer,this.withJwksUri(s))}}else this.issuersConfig.set(r.issuer,this.withJwksUri(r))}get expectedIssuers(){return Array.from(this.issuersConfig.keys())}getIssuerConfig(r){if(!r){if(this.issuersConfig.size!==1)throw new M("issuer must be provided");r=this.issuersConfig.keys().next().value}let i=this.issuersConfig.get(r);if(!i)throw new M(`issuer not configured: ${r}`);return i}cacheJwks(...[r,i]){let s=this.getIssuerConfig(i);this.jwksCache.addJwks(s.jwksUri,r),this.publicKeyCache.clearCache(s.issuer)}async hydrate(){let r=this.expectedIssuers.map(i=>this.getIssuerConfig(i).jwksUri).map(i=>this.jwksCache.getJwks(i));await Promise.all(r)}verifySync(...[r,i]){let{decomposedJwt:s,jwksUri:a,verifyProperties:f}=this.getVerifyParameters(r,i);return this.verifyDecomposedJwtSync(s,a,f)}verifyDecomposedJwtSync(r,i,s){let a=this.jwksCache.getCachedJwk(i,r);return Yl(r,a,s,this.publicKeyCache.transformJwkToKeyObjectSync.bind(this.publicKeyCache))}async verify(...[r,i]){let{decomposedJwt:s,jwksUri:a,verifyProperties:f}=this.getVerifyParameters(r,i);return this.verifyDecomposedJwt(s,a,f)}verifyDecomposedJwt(r,i,s){return Vl(r,i,s,this.jwksCache.getJwk.bind(this.jwksCache),this.publicKeyCache.transformJwkToKeyObjectAsync.bind(this.publicKeyCache))}getVerifyParameters(r,i){let s=Xi(r);Be("Issuer",s.payload.iss,this.expectedIssuers,Et);let a=this.getIssuerConfig(s.payload.iss);return{decomposedJwt:s,jwksUri:a.jwksUri,verifyProperties:{...a,...i}}}withJwksUri(r){if(r.jwksUri)return r;let i=new URL(r.issuer).pathname.replace(/\/$/,"");return{jwksUri:new URL(`${i}/.well-known/jwks.json`,r.issuer).href,...r}}};var uo=class{constructor(r=V.transformJwkToKeyObjectSync,i=V.transformJwkToKeyObjectAsync){this.transformJwkToKeyObjectSyncFn=r,this.transformJwkToKeyObjectAsyncFn=i,this.publicKeys=new Map}transformJwkToKeyObjectSync(r,i,s){let a=r.alg??i;if(!s||!r.kid||!a)return this.transformJwkToKeyObjectSyncFn(r,a,s);let f=this.publicKeys.get(s)?.get(r.kid)?.get(a);if(f)return f;let h=this.transformJwkToKeyObjectSyncFn(r,a,s);return this.putKeyObjectInCache(s,r.kid,a,h),h}async transformJwkToKeyObjectAsync(r,i,s){let a=r.alg??i;if(!s||!r.kid||!a)return this.transformJwkToKeyObjectAsyncFn(r,a,s);let f=this.publicKeys.get(s)?.get(r.kid)?.get(a);if(f)return f;let h=await this.transformJwkToKeyObjectAsyncFn(r,a,s);return this.putKeyObjectInCache(s,r.kid,a,h),h}putKeyObjectInCache(r,i,s,a){let f=this.publicKeys.get(r),h=f?.get(i);h?h.set(s,a):f?f.set(i,new Map([[s,a]])):this.publicKeys.set(r,new Map([[i,new Map([[s,a]])]]))}clearCache(r){this.publicKeys.delete(r)}};function ts(n,r){if(r.groups!=null&&Bt("Cognito group",n["cognito:groups"],r.groups,Kr),Be("Token use",n.token_use,["id","access"],Qt),r.tokenUse!==null){if(r.tokenUse===void 0)throw new M("tokenUse must be provided or set to null explicitly");at("Token use",n.token_use,r.tokenUse,Qt)}if(r.clientId!==null){if(r.clientId===void 0)throw new M("clientId must be provided or set to null explicitly");n.token_use==="id"?Be('Client ID ("audience")',n.aud,r.clientId,Gt):Be("Client ID",n.client_id,r.clientId,Gt)}}var tr=class n extends rn{constructor(r,i){let s=Array.isArray(r)?r.map(a=>({...a,...n.parseUserPoolId(a.userPoolId),audience:null})):{...r,...n.parseUserPoolId(r.userPoolId),audience:null};super(s,i)}static parseUserPoolId(r){let i=r.match(/^(?<region>(\w+-)?\w+-\w+-\d)+_\w+$/);if(!i)throw new M(`Invalid Cognito User Pool ID: ${r}`);let a=`https://cognito-idp.${i.groups.region}.amazonaws.com/${r}`;return{issuer:a,jwksUri:`${a}/.well-known/jwks.json`}}static create(r,i){return new this(r,i?.jwksCache)}verifySync(...[r,i]){let{decomposedJwt:s,jwksUri:a,verifyProperties:f}=this.getVerifyParameters(r,i);this.verifyDecomposedJwtSync(s,a,f);try{ts(s.payload,f)}catch(h){throw f.includeRawJwtInErrors&&h instanceof N?h.withRawJwt(s):h}return s.payload}async verify(...[r,i]){let{decomposedJwt:s,jwksUri:a,verifyProperties:f}=this.getVerifyParameters(r,i);await this.verifyDecomposedJwt(s,a,f);try{ts(s.payload,f)}catch(h){throw f.includeRawJwtInErrors&&h instanceof N?h.withRawJwt(s):h}return s.payload}cacheJwks(...[r,i]){let s;if(i!==void 0)s=n.parseUserPoolId(i).issuer;else if(this.expectedIssuers.length>1)throw new M("userPoolId must be provided");let a=this.getIssuerConfig(s);super.cacheJwks(r,a.issuer)}};var qs=He(require("http"),1),Fs=He(require("https"),1),ht=He(require("zlib"),1),re=He(require("stream"),1),cr=require("buffer");function Ql(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let r=n.indexOf(",");if(r===-1||r<=4)throw new TypeError("malformed data: URI");let i=n.substring(5,r).split(";"),s="",a=!1,f=i[0]||"text/plain",h=f;for(let b=1;b<i.length;b++)i[b]==="base64"?a=!0:i[b]&&(h+=`;${i[b]}`,i[b].indexOf("charset=")===0&&(s=i[b].substring(8)));!i[0]&&!s.length&&(h+=";charset=US-ASCII",s="US-ASCII");let w=a?"base64":"ascii",p=unescape(n.substring(r+1)),m=Buffer.from(p,w);return m.type=f,m.typeFull=h,m.charset=s,m}var rs=Ql;var ae=He(require("stream"),1),De=require("util"),ee=require("buffer");nr();sn();var Oe=class extends Error{constructor(r,i){super(r),Error.captureStackTrace(this,this.constructor),this.type=i}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Y=class extends Oe{constructor(r,i,s){super(r,i),s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}};var an=Symbol.toStringTag,mo=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[an]==="URLSearchParams",ar=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[an]),hs=n=>typeof n=="object"&&(n[an]==="AbortSignal"||n[an]==="EventTarget"),ms=(n,r)=>{let i=new URL(r).hostname,s=new URL(n).hostname;return i===s||i.endsWith(`.${s}`)},ps=(n,r)=>{let i=new URL(r).protocol,s=new URL(n).protocol;return i===s};var cu=(0,De.promisify)(ae.default.pipeline),Q=Symbol("Body internals"),ge=class{constructor(r,{size:i=0}={}){let s=null;r===null?r=null:mo(r)?r=ee.Buffer.from(r.toString()):ar(r)||ee.Buffer.isBuffer(r)||(De.types.isAnyArrayBuffer(r)?r=ee.Buffer.from(r):ArrayBuffer.isView(r)?r=ee.Buffer.from(r.buffer,r.byteOffset,r.byteLength):r instanceof ae.default||(r instanceof ft?(r=ds(r),s=r.type.split("=")[1]):r=ee.Buffer.from(String(r))));let a=r;ee.Buffer.isBuffer(r)?a=ae.default.Readable.from(r):ar(r)&&(a=ae.default.Readable.from(r.stream())),this[Q]={body:r,stream:a,boundary:s,disturbed:!1,error:null},this.size=i,r instanceof ae.default&&r.on("error",f=>{let h=f instanceof Oe?f:new Y(`Invalid response body while trying to fetch ${this.url}: ${f.message}`,"system",f);this[Q].error=h})}get body(){return this[Q].stream}get bodyUsed(){return this[Q].disturbed}async arrayBuffer(){let{buffer:r,byteOffset:i,byteLength:s}=await yo(this);return r.slice(i,i+s)}async formData(){let r=this.headers.get("content-type");if(r.startsWith("application/x-www-form-urlencoded")){let s=new ft,a=new URLSearchParams(await this.text());for(let[f,h]of a)s.append(f,h);return s}let{toFormData:i}=await Promise.resolve().then(()=>(Ss(),ws));return i(this.body,r)}async blob(){let r=this.headers&&this.headers.get("content-type")||this[Q].body&&this[Q].body.type||"",i=await this.arrayBuffer();return new Ie([i],{type:r})}async json(){let r=await this.text();return JSON.parse(r)}async text(){let r=await yo(this);return new TextDecoder().decode(r)}buffer(){return yo(this)}};ge.prototype.buffer=(0,De.deprecate)(ge.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ge.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,De.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function yo(n){if(n[Q].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[Q].disturbed=!0,n[Q].error)throw n[Q].error;let{body:r}=n;if(r===null)return ee.Buffer.alloc(0);if(!(r instanceof ae.default))return ee.Buffer.alloc(0);let i=[],s=0;try{for await(let a of r){if(n.size>0&&s+a.length>n.size){let f=new Y(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw r.destroy(f),f}s+=a.length,i.push(a)}}catch(a){throw a instanceof Oe?a:new Y(`Invalid response body while trying to fetch ${n.url}: ${a.message}`,"system",a)}if(r.readableEnded===!0||r._readableState.ended===!0)try{return i.every(a=>typeof a=="string")?ee.Buffer.from(i.join("")):ee.Buffer.concat(i,s)}catch(a){throw new Y(`Could not create Buffer from response body for ${n.url}: ${a.message}`,"system",a)}else throw new Y(`Premature close of server response while trying to fetch ${n.url}`)}var Dt=(n,r)=>{let i,s,{body:a}=n[Q];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof ae.default&&typeof a.getBoundary!="function"&&(i=new ae.PassThrough({highWaterMark:r}),s=new ae.PassThrough({highWaterMark:r}),a.pipe(i),a.pipe(s),n[Q].stream=i,a=s),a},du=(0,De.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),cn=(n,r)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":mo(n)?"application/x-www-form-urlencoded;charset=UTF-8":ar(n)?n.type||null:ee.Buffer.isBuffer(n)||De.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof ft?`multipart/form-data; boundary=${r[Q].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${du(n)}`:n instanceof ae.default?null:"text/plain;charset=UTF-8",_s=n=>{let{body:r}=n[Q];return r===null?0:ar(r)?r.size:ee.Buffer.isBuffer(r)?r.length:r&&typeof r.getLengthSync=="function"&&r.hasKnownLength&&r.hasKnownLength()?r.getLengthSync():null},Rs=async(n,{body:r})=>{r===null?n.end():await cu(r,n)};var go=require("util"),ur=He(require("http"),1),dn=typeof ur.default.validateHeaderName=="function"?ur.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let r=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),r}},wo=typeof ur.default.validateHeaderValue=="function"?ur.default.validateHeaderValue:(n,r)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(r)){let i=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(i,"code",{value:"ERR_INVALID_CHAR"}),i}},te=class n extends URLSearchParams{constructor(r){let i=[];if(r instanceof n){let s=r.raw();for(let[a,f]of Object.entries(s))i.push(...f.map(h=>[a,h]))}else if(r!=null)if(typeof r=="object"&&!go.types.isBoxedPrimitive(r)){let s=r[Symbol.iterator];if(s==null)i.push(...Object.entries(r));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");i=[...r].map(a=>{if(typeof a!="object"||go.types.isBoxedPrimitive(a))throw new TypeError("Each header pair must be an iterable object");return[...a]}).map(a=>{if(a.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...a]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return i=i.length>0?i.map(([s,a])=>(dn(s),wo(s,String(a)),[String(s).toLowerCase(),String(a)])):void 0,super(i),new Proxy(this,{get(s,a,f){switch(a){case"append":case"set":return(h,w)=>(dn(h),wo(h,String(w)),URLSearchParams.prototype[a].call(s,String(h).toLowerCase(),String(w)));case"delete":case"has":case"getAll":return h=>(dn(h),URLSearchParams.prototype[a].call(s,String(h).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,a,f)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(r){let i=this.getAll(r);if(i.length===0)return null;let s=i.join(", ");return/^content-encoding$/i.test(r)&&(s=s.toLowerCase()),s}forEach(r,i=void 0){for(let s of this.keys())Reflect.apply(r,i,[this.get(s),s,this])}*values(){for(let r of this.keys())yield this.get(r)}*entries(){for(let r of this.keys())yield[r,this.get(r)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((r,i)=>(r[i]=this.getAll(i),r),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((r,i)=>{let s=this.getAll(i);return i==="host"?r[i]=s[0]:r[i]=s.length>1?s:s[0],r},{})}};Object.defineProperties(te.prototype,["get","entries","forEach","values"].reduce((n,r)=>(n[r]={enumerable:!0},n),{}));function Ts(n=[]){return new te(n.reduce((r,i,s,a)=>(s%2===0&&r.push(a.slice(s,s+2)),r),[]).filter(([r,i])=>{try{return dn(r),wo(r,String(i)),!0}catch{return!1}}))}var hu=new Set([301,302,303,307,308]),hn=n=>hu.has(n);var he=Symbol("Response internals"),le=class n extends ge{constructor(r=null,i={}){super(r,i);let s=i.status!=null?i.status:200,a=new te(i.headers);if(r!==null&&!a.has("Content-Type")){let f=cn(r,this);f&&a.append("Content-Type",f)}this[he]={type:"default",url:i.url,status:s,statusText:i.statusText||"",headers:a,counter:i.counter,highWaterMark:i.highWaterMark}}get type(){return this[he].type}get url(){return this[he].url||""}get status(){return this[he].status}get ok(){return this[he].status>=200&&this[he].status<300}get redirected(){return this[he].counter>0}get statusText(){return this[he].statusText}get headers(){return this[he].headers}get highWaterMark(){return this[he].highWaterMark}clone(){return new n(Dt(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(r,i=302){if(!hn(i))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(r).toString()},status:i})}static error(){let r=new n(null,{status:0,statusText:""});return r[he].type="error",r}static json(r=void 0,i={}){let s=JSON.stringify(r);if(s===void 0)throw new TypeError("data is not JSON serializable");let a=new te(i&&i.headers);return a.has("content-type")||a.set("content-type","application/json"),new n(s,{...i,headers:a})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(le.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Is=require("url"),Os=require("util");var Cs=n=>{if(n.search)return n.search;let r=n.href.length-1,i=n.hash||(n.href[r]==="#"?"#":"");return n.href[r-i.length]==="?"?"?":""};var Es=require("net");function Ps(n,r=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",r&&(n.pathname="",n.search=""),n)}var As=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),vs="strict-origin-when-cross-origin";function ks(n){if(!As.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function mu(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let r=n.host.replace(/(^\[)|(]$)/g,""),i=(0,Es.isIP)(r);return i===4&&/^127\./.test(r)||i===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(r)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function qt(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:mu(n)}function Bs(n,{referrerURLCallback:r,referrerOriginCallback:i}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let s=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let a=n.referrer,f=Ps(a),h=Ps(a,!0);f.toString().length>4096&&(f=h),r&&(f=r(f)),i&&(h=i(h));let w=new URL(n.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return h;case"unsafe-url":return f;case"strict-origin":return qt(f)&&!qt(w)?"no-referrer":h.toString();case"strict-origin-when-cross-origin":return f.origin===w.origin?f:qt(f)&&!qt(w)?"no-referrer":h;case"same-origin":return f.origin===w.origin?f:"no-referrer";case"origin-when-cross-origin":return f.origin===w.origin?f:h;case"no-referrer-when-downgrade":return qt(f)&&!qt(w)?"no-referrer":f;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}function Ws(n){let r=(n.get("referrer-policy")||"").split(/[,\s]+/),i="";for(let s of r)s&&As.has(s)&&(i=s);return i}var j=Symbol("Request internals"),fr=n=>typeof n=="object"&&typeof n[j]=="object",pu=(0,Os.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),dt=class n extends ge{constructor(r,i={}){let s;if(fr(r)?s=new URL(r.url):(s=new URL(r),r={}),s.username!==""||s.password!=="")throw new TypeError(`${s} is an url with embedded credentials.`);let a=i.method||r.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(a)&&(a=a.toUpperCase()),!fr(i)&&"data"in i&&pu(),(i.body!=null||fr(r)&&r.body!==null)&&(a==="GET"||a==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let f=i.body?i.body:fr(r)&&r.body!==null?Dt(r):null;super(f,{size:i.size||r.size||0});let h=new te(i.headers||r.headers||{});if(f!==null&&!h.has("Content-Type")){let m=cn(f,this);m&&h.set("Content-Type",m)}let w=fr(r)?r.signal:null;if("signal"in i&&(w=i.signal),w!=null&&!hs(w))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let p=i.referrer==null?r.referrer:i.referrer;if(p==="")p="no-referrer";else if(p){let m=new URL(p);p=/^about:(\/\/)?client$/.test(m)?"client":m}else p=void 0;this[j]={method:a,redirect:i.redirect||r.redirect||"follow",headers:h,parsedURL:s,signal:w,referrer:p},this.follow=i.follow===void 0?r.follow===void 0?20:r.follow:i.follow,this.compress=i.compress===void 0?r.compress===void 0?!0:r.compress:i.compress,this.counter=i.counter||r.counter||0,this.agent=i.agent||r.agent,this.highWaterMark=i.highWaterMark||r.highWaterMark||16384,this.insecureHTTPParser=i.insecureHTTPParser||r.insecureHTTPParser||!1,this.referrerPolicy=i.referrerPolicy||r.referrerPolicy||""}get method(){return this[j].method}get url(){return(0,Is.format)(this[j].parsedURL)}get headers(){return this[j].headers}get redirect(){return this[j].redirect}get signal(){return this[j].signal}get referrer(){if(this[j].referrer==="no-referrer")return"";if(this[j].referrer==="client")return"about:client";if(this[j].referrer)return this[j].referrer.toString()}get referrerPolicy(){return this[j].referrerPolicy}set referrerPolicy(r){this[j].referrerPolicy=ks(r)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(dt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Ds=n=>{let{parsedURL:r}=n[j],i=new te(n[j].headers);i.has("Accept")||i.set("Accept","*/*");let s=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(s="0"),n.body!==null){let w=_s(n);typeof w=="number"&&!Number.isNaN(w)&&(s=String(w))}s&&i.set("Content-Length",s),n.referrerPolicy===""&&(n.referrerPolicy=vs),n.referrer&&n.referrer!=="no-referrer"?n[j].referrer=Bs(n):n[j].referrer="no-referrer",n[j].referrer instanceof URL&&i.set("Referer",n.referrer),i.has("User-Agent")||i.set("User-Agent","node-fetch"),n.compress&&!i.has("Accept-Encoding")&&i.set("Accept-Encoding","gzip, deflate, br");let{agent:a}=n;typeof a=="function"&&(a=a(r));let f=Cs(r),h={path:r.pathname+f,method:n.method,headers:i[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:a};return{parsedURL:r,options:h}};var mn=class extends Oe{constructor(r,i="aborted"){super(r,i)}};sn();po();var bu=new Set(["data:","http:","https:"]);async function pn(n,r){return new Promise((i,s)=>{let a=new dt(n,r),{parsedURL:f,options:h}=Ds(a);if(!bu.has(f.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${f.protocol.replace(/:$/,"")}" is not supported.`);if(f.protocol==="data:"){let g=rs(a.url),F=new le(g,{headers:{"Content-Type":g.typeFull}});i(F);return}let w=(f.protocol==="https:"?Fs.default:qs.default).request,{signal:p}=a,m=null,b=()=>{let g=new mn("The operation was aborted.");s(g),a.body&&a.body instanceof re.default.Readable&&a.body.destroy(g),!(!m||!m.body)&&m.body.emit("error",g)};if(p&&p.aborted){b();return}let W=()=>{b(),O()},T=w(f.toString(),h);p&&p.addEventListener("abort",W);let O=()=>{T.abort(),p&&p.removeEventListener("abort",W)};T.on("error",g=>{s(new Y(`request to ${a.url} failed, reason: ${g.message}`,"system",g)),O()}),yu(T,g=>{m&&m.body&&m.body.destroy(g)}),process.version<"v14"&&T.on("socket",g=>{let F;g.prependListener("end",()=>{F=g._eventsCount}),g.prependListener("close",v=>{if(m&&F<g._eventsCount&&!v){let A=new Error("Premature close");A.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",A)}})}),T.on("response",g=>{T.setTimeout(0);let F=Ts(g.rawHeaders);if(hn(g.statusCode)){let k=F.get("Location"),B=null;try{B=k===null?null:new URL(k,a.url)}catch{if(a.redirect!=="manual"){s(new Y(`uri requested responds with an invalid redirect URL: ${k}`,"invalid-redirect")),O();return}}switch(a.redirect){case"error":s(new Y(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),O();return;case"manual":break;case"follow":{if(B===null)break;if(a.counter>=a.follow){s(new Y(`maximum redirect reached at: ${a.url}`,"max-redirect")),O();return}let L={headers:new te(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:Dt(a),signal:a.signal,size:a.size,referrer:a.referrer,referrerPolicy:a.referrerPolicy};if(!ms(a.url,B)||!ps(a.url,B))for(let Ft of["authorization","www-authenticate","cookie","cookie2"])L.headers.delete(Ft);if(g.statusCode!==303&&a.body&&r.body instanceof re.default.Readable){s(new Y("Cannot follow redirect with body being a readable stream","unsupported-redirect")),O();return}(g.statusCode===303||(g.statusCode===301||g.statusCode===302)&&a.method==="POST")&&(L.method="GET",L.body=void 0,L.headers.delete("content-length"));let qe=Ws(F);qe&&(L.referrerPolicy=qe),i(pn(new dt(B,L))),O();return}default:return s(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}p&&g.once("end",()=>{p.removeEventListener("abort",W)});let v=(0,re.pipeline)(g,new re.PassThrough,k=>{k&&s(k)});process.version<"v12.10"&&g.on("aborted",W);let A={url:a.url,status:g.statusCode,statusText:g.statusMessage,headers:F,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},x=F.get("Content-Encoding");if(!a.compress||a.method==="HEAD"||x===null||g.statusCode===204||g.statusCode===304){m=new le(v,A),i(m);return}let U={flush:ht.default.Z_SYNC_FLUSH,finishFlush:ht.default.Z_SYNC_FLUSH};if(x==="gzip"||x==="x-gzip"){v=(0,re.pipeline)(v,ht.default.createGunzip(U),k=>{k&&s(k)}),m=new le(v,A),i(m);return}if(x==="deflate"||x==="x-deflate"){let k=(0,re.pipeline)(g,new re.PassThrough,B=>{B&&s(B)});k.once("data",B=>{(B[0]&15)===8?v=(0,re.pipeline)(v,ht.default.createInflate(),L=>{L&&s(L)}):v=(0,re.pipeline)(v,ht.default.createInflateRaw(),L=>{L&&s(L)}),m=new le(v,A),i(m)}),k.once("end",()=>{m||(m=new le(v,A),i(m))});return}if(x==="br"){v=(0,re.pipeline)(v,ht.default.createBrotliDecompress(),k=>{k&&s(k)}),m=new le(v,A),i(m);return}m=new le(v,A),i(m)}),Rs(T,a).catch(s)})}function yu(n,r){let i=cr.Buffer.from(`0\r
\r
`),s=!1,a=!1,f;n.on("response",h=>{let{headers:w}=h;s=w["transfer-encoding"]==="chunked"&&!w["content-length"]}),n.on("socket",h=>{let w=()=>{if(s&&!a){let m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",r(m)}},p=m=>{a=cr.Buffer.compare(m.slice(-5),i)===0,!a&&f&&(a=cr.Buffer.compare(f.slice(-3),i.slice(0,3))===0&&cr.Buffer.compare(m.slice(-2),i.slice(3))===0),f=m};h.prependListener("close",w),h.on("data",p),n.on("close",()=>{h.removeListener("close",w),h.removeListener("data",p)})})}var gu=process.env.USER_POOL_ID,wu=process.env.APP_CLIENT_ID,Ls=process.env.ADMIN_ONLY?.toLowerCase()==="true",zs=process.env.ADMIN_LIST?process.env.ADMIN_LIST.split(",").map(n=>n.trim()):[],$s=process.env.COGNITO_DOMAIN_PREFIX,js=process.env.REGION;console.log("AdminOnly:",Ls);console.log("AdminList:",zs);console.log("CognitoDomainPrefix:",$s);console.log("Region:",js);async function Su(n){return(await _u(n)).username}async function _u(n){let r=`https://${$s}.auth.${js}.amazoncognito.com/oauth2/userInfo`,i={Authorization:`Bearer ${n}`};try{let s=await pn(r,{headers:i});return s.ok?await s.json():{statusCode:s.status,statusText:await s.text()}}catch(s){throw console.error("Request failed:",s),s}}var Ru=async(n,r)=>{try{let i=tr.create({userPoolId:gu,tokenUse:"access",clientId:wu});console.log("Event:",n);let s=Tu(n),a=await i.verify(s);if(console.log("Token is valid. Payload:",a),Ls){let f=await Su(s);if(!zs.includes(f))return console.log(`User ${f} is not an admin, denying access.`),xs();console.log(`User ${f} is an admin, granting access.`)}else console.log("User doesn't need to be an admin, granting access.");return Cu(n.methodArn,a)}catch(i){return console.log(i.message),xs()}};function Tu(n){let r=n.headers,i;if(r?i=r.Authorization||r.authorization:i=n.authorizationToken,!i)throw new Error("Authorization header is missing");let s=i.split(" ");if(s[0]!=="Bearer"||s.length!==2)throw new Error("Invalid Authorization token format");return s[1]}var xs=()=>({principalId:"*",policyDocument:{Version:"2012-10-17",Statement:[{Action:"*",Effect:"Deny",Resource:"*"}]}}),Cu=(n,r)=>({principalId:r.sub,policyDocument:{Version:"2012-10-17",Statement:[{Action:"execute-api:Invoke",Effect:"Allow",Resource:n}]},context:{userId:r.sub}});0&&(module.exports={handler});
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)
*/
//# sourceMappingURL=index.js.map
